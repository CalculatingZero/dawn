"use strict";
(self["webpackChunkthirdweb_learn_theme"] = self["webpackChunkthirdweb_learn_theme"] || []).push([["vendors-node_modules_thirdweb-dev_wallets_evm_connectors_wallet-connect-v1_dist_thirdweb-dev--bd6ef4"],{

/***/ "./node_modules/@thirdweb-dev/wallets/dist/WagmiConnector-60b19604.browser.esm.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/wallets/dist/WagmiConnector-60b19604.browser.esm.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   W: () => (/* binding */ WagmiConnector)
/* harmony export */ });
/* harmony import */ var _defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./defineProperty-c8ecdc07.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/defineProperty-c8ecdc07.browser.esm.js");
/* harmony import */ var _thirdweb_dev_chains__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @thirdweb-dev/chains */ "./node_modules/@thirdweb-dev/chains/dist/thirdweb-dev-chains.browser.esm.js");
/* harmony import */ var eventemitter3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/index.mjs");




class WagmiConnector extends eventemitter3__WEBPACK_IMPORTED_MODULE_0__["default"] {
  /** Unique connector id */

  /** Connector name */

  /** Chains connector supports */

  /** Options to use with connector */

  /** Whether connector is usable */

  constructor(_ref) {
    let {
      chains = _thirdweb_dev_chains__WEBPACK_IMPORTED_MODULE_1__.defaultChains,
      options
    } = _ref;
    super();
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, "id", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, "name", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, "chains", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, "options", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, "ready", void 0);
    this.chains = chains;
    this.options = options;
  }
  getBlockExplorerUrls(chain) {
    const explorers = chain.explorers?.map(x => x.url) ?? [];
    return explorers.length > 0 ? explorers : undefined;
  }
  isChainUnsupported(chainId) {
    return !this.chains.some(x => x.chainId === chainId);
  }
  updateChains(chains) {
    this.chains = chains;
  }
}




/***/ }),

/***/ "./node_modules/@thirdweb-dev/wallets/dist/errors-105ad187.browser.esm.js":
/*!********************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/wallets/dist/errors-105ad187.browser.esm.js ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   A: () => (/* binding */ AddChainError),
/* harmony export */   C: () => (/* binding */ ChainNotConfiguredError),
/* harmony export */   P: () => (/* binding */ ProviderRpcError),
/* harmony export */   R: () => (/* binding */ ResourceUnavailableError),
/* harmony export */   S: () => (/* binding */ SwitchChainError),
/* harmony export */   U: () => (/* binding */ UserRejectedRequestError),
/* harmony export */   a: () => (/* binding */ ConnectorNotFoundError)
/* harmony export */ });
/* harmony import */ var _defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./defineProperty-c8ecdc07.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/defineProperty-c8ecdc07.browser.esm.js");


/**
 * Error subclass implementing JSON RPC 2.0 errors and Ethereum RPC errors per EIP-1474.
 * @see https://eips.ethereum.org/EIPS/eip-1474
 */
class RpcError extends Error {
  constructor( /** Human-readable string */
  message, options) {
    const {
      cause,
      code,
      data
    } = options;
    if (!Number.isInteger(code)) {
      throw new Error('"code" must be an integer.');
    }
    if (!message || typeof message !== "string") {
      throw new Error('"message" must be a nonempty string.');
    }
    super(message);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "cause", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "code", void 0);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "data", void 0);
    this.cause = cause;
    this.code = code;
    this.data = data;
  }
}

/**
 * Error subclass implementing Ethereum Provider errors per EIP-1193.
 * @see https://eips.ethereum.org/EIPS/eip-1193
 */
class ProviderRpcError extends RpcError {
  /**
   * Create an Ethereum Provider JSON-RPC error.
   * `code` must be an integer in the 1000 <= 4999 range.
   */
  constructor( /** Human-readable string */
  message, options) {
    const {
      cause,
      code,
      data
    } = options;
    if (!(Number.isInteger(code) && code >= 1000 && code <= 4999)) {
      throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');
    }
    super(message, {
      cause,
      code,
      data
    });
  }
}
class AddChainError extends Error {
  constructor() {
    super(...arguments);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "AddChainError");
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "message", "Error adding chain");
  }
}
class ChainNotConfiguredError extends Error {
  constructor(_ref) {
    let {
      chainId,
      connectorId
    } = _ref;
    super(`Chain "${chainId}" not configured for connector "${connectorId}".`);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "ChainNotConfigured");
  }
}
class ConnectorNotFoundError extends Error {
  constructor() {
    super(...arguments);
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "ConnectorNotFoundError");
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "message", "Connector not found");
  }
}
class ResourceUnavailableError extends RpcError {
  constructor(cause) {
    super("Resource unavailable", {
      cause,
      code: -32002
    });
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "ResourceUnavailable");
  }
}
class SwitchChainError extends ProviderRpcError {
  constructor(cause) {
    super("Error switching chain", {
      cause,
      code: 4902
    });
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "SwitchChainError");
  }
}
class UserRejectedRequestError extends ProviderRpcError {
  constructor(cause) {
    super("User rejected request", {
      cause,
      code: 4001
    });
    (0,_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_0__._)(this, "name", "UserRejectedRequestError");
  }
}

// Ethers does not have an error type so we can use this for casting
// https://github.com/ethers-io/ethers.js/blob/main/packages/logger/src.ts/index.ts#L268




/***/ }),

/***/ "./node_modules/@thirdweb-dev/wallets/dist/normalizeChainId-e4cc0175.browser.esm.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/wallets/dist/normalizeChainId-e4cc0175.browser.esm.js ***!
  \******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   n: () => (/* binding */ normalizeChainId)
/* harmony export */ });
function normalizeChainId(chainId) {
  if (typeof chainId === "string") {
    return Number.parseInt(chainId, chainId.trim().substring(0, 2) === "0x" ? 16 : 10);
  }
  if (typeof chainId === "bigint") {
    return Number(chainId);
  }
  return chainId;
}




/***/ }),

/***/ "./node_modules/@thirdweb-dev/wallets/evm/connectors/wallet-connect-v1/dist/thirdweb-dev-wallets-evm-connectors-wallet-connect-v1.browser.esm.js":
/*!*******************************************************************************************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/wallets/evm/connectors/wallet-connect-v1/dist/thirdweb-dev-wallets-evm-connectors-wallet-connect-v1.browser.esm.js ***!
  \*******************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   WalletConnectV1Connector: () => (/* binding */ WalletConnectV1Connector)
/* harmony export */ });
/* harmony import */ var _dist_classPrivateMethodGet_ea199cc3_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../dist/classPrivateMethodGet-ea199cc3.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/classPrivateMethodGet-ea199cc3.browser.esm.js");
/* harmony import */ var _dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../dist/classPrivateFieldSet-a5db7c83.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/classPrivateFieldSet-a5db7c83.browser.esm.js");
/* harmony import */ var _dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../dist/defineProperty-c8ecdc07.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/defineProperty-c8ecdc07.browser.esm.js");
/* harmony import */ var _dist_walletIds_1ea97411_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../dist/walletIds-1ea97411.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/walletIds-1ea97411.browser.esm.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/address/lib.esm/index.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/providers/lib.esm/web3-provider.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/bytes/lib.esm/index.js");
/* harmony import */ var _dist_WagmiConnector_60b19604_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../dist/WagmiConnector-60b19604.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/WagmiConnector-60b19604.browser.esm.js");
/* harmony import */ var _dist_normalizeChainId_e4cc0175_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../dist/normalizeChainId-e4cc0175.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/normalizeChainId-e4cc0175.browser.esm.js");
/* harmony import */ var _dist_errors_105ad187_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../dist/errors-105ad187.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/errors-105ad187.browser.esm.js");
/* harmony import */ var eventemitter3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/index.mjs");
/* provided dependency */ var console = __webpack_require__(/*! ./node_modules/console-browserify/index.js */ "./node_modules/console-browserify/index.js");











/**
 * Wallets that support chain switching through WalletConnect
 * - imToken (token.im)
 * - MetaMask (metamask.io)
 * - Rainbow (rainbow.me)
 * - Trust Wallet (trustwallet.com)
 */
// const switchChainAllowedRegex = /(imtoken|metamask|rainbow|trust wallet)/i;

const LAST_USED_CHAIN_ID = "last-used-chain-id";
const LAST_SESSION = "last-session";
var _provider = /*#__PURE__*/new WeakMap();
var _storage = /*#__PURE__*/new WeakMap();
var _handleConnected = /*#__PURE__*/new WeakSet();
var _removeListeners = /*#__PURE__*/new WeakSet();
class WalletConnectV1Connector extends _dist_WagmiConnector_60b19604_browser_esm_js__WEBPACK_IMPORTED_MODULE_1__.W {
  constructor(config) {
    super(config);
    (0,_dist_classPrivateMethodGet_ea199cc3_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, _removeListeners);
    (0,_dist_classPrivateMethodGet_ea199cc3_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__._)(this, _handleConnected);
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "id", _dist_walletIds_1ea97411_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.w.walletConnectV1);
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "name", "WalletConnectV1");
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "ready", true);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__._)(this, _provider, {
      writable: true,
      value: void 0
    });
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__._)(this, _storage, {
      writable: true,
      value: void 0
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "walletName", void 0);
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onSwitchChain", () => {
      this.emit("message", {
        type: "switch_chain"
      });
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onDisplayUri", async (error, payload) => {
      if (error) {
        this.emit("message", {
          data: error,
          type: "display_uri_error"
        });
      }
      this.emit("message", {
        data: payload.params[0],
        type: "display_uri"
      });
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onRequestSent", (error, payload) => {
      if (error) {
        this.emit("message", {
          data: error,
          type: "request"
        });
      }
      this.emit("message", {
        data: payload.params[0],
        type: "request"
      });
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onMessage", message => {
      this.emit("message", message);
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onAccountsChanged", accounts => {
      if (accounts.length === 0) {
        this.emit("disconnect");
      } else {
        this.emit("change", {
          account: ethers__WEBPACK_IMPORTED_MODULE_6__.getAddress(accounts[0])
        });
      }
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onChainChanged", chainId => {
      const id = (0,_dist_normalizeChainId_e4cc0175_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.n)(chainId);
      const unsupported = this.isChainUnsupported(id);
      (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).setItem(LAST_USED_CHAIN_ID, String(chainId));
      this.emit("change", {
        chain: {
          id,
          unsupported
        }
      });
    });
    (0,_dist_defineProperty_c8ecdc07_browser_esm_js__WEBPACK_IMPORTED_MODULE_3__._)(this, "onDisconnect", async () => {
      this.walletName = undefined;
      (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).removeItem(LAST_USED_CHAIN_ID);
      (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).removeItem(LAST_SESSION);
      (0,_dist_classPrivateMethodGet_ea199cc3_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, _removeListeners, _removeListeners2).call(this);
      this.emit("disconnect");
    });
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.a)(this, _storage, config.storage);
  }
  async connect() {
    let {
      chainId
    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    try {
      let targetChainId = chainId;
      if (!targetChainId) {
        const lastUsedChainIdStr = await (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).getItem(LAST_USED_CHAIN_ID);
        const lastUsedChainId = lastUsedChainIdStr ? parseInt(lastUsedChainIdStr) : undefined;
        if (lastUsedChainId && !this.isChainUnsupported(lastUsedChainId)) {
          targetChainId = lastUsedChainId;
        }
      }
      const provider = await this.getProvider({
        chainId: targetChainId,
        create: true
      });
      this.setupListeners();

      // Defer message to the next tick to ensure wallet connect data (provided by `.enable()`) is available
      setTimeout(() => this.emit("message", {
        type: "connecting"
      }), 0);
      const accounts = await provider.enable();
      const account = ethers__WEBPACK_IMPORTED_MODULE_6__.getAddress(accounts[0]);
      let id = await this.getChainId();
      let unsupported = this.isChainUnsupported(id);

      // Not all WalletConnect options support programmatic chain switching
      // Only enable for wallet options that do
      this.walletName = provider.connector?.peerMeta?.name ?? "";

      // switch to target chainId
      if (chainId) {
        try {
          await this.switchChain(chainId);
          id = chainId;
          unsupported = this.isChainUnsupported(id);
        } catch (e) {
          console.error(`could not switch to desired chain id: ${chainId} `, e);
        }
      }
      (0,_dist_classPrivateMethodGet_ea199cc3_browser_esm_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, _handleConnected, _handleConnected2).call(this);
      this.emit("connect", {
        account,
        chain: {
          id,
          unsupported
        },
        provider
      });
      return {
        account,
        chain: {
          id,
          unsupported
        },
        provider: new ethers__WEBPACK_IMPORTED_MODULE_8__.Web3Provider(provider)
      };
    } catch (error) {
      if (/user closed modal/i.test(error.message)) {
        throw new _dist_errors_105ad187_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.U(error);
      }
      throw error;
    }
  }
  async disconnect() {
    const provider = await this.getProvider();
    await provider.disconnect();
  }
  async getAccount() {
    const provider = await this.getProvider();
    const accounts = provider.accounts;
    // return checksum address
    return ethers__WEBPACK_IMPORTED_MODULE_6__.getAddress(accounts[0]);
  }
  async getChainId() {
    const provider = await this.getProvider();
    const chainId = (0,_dist_normalizeChainId_e4cc0175_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.n)(provider.chainId);
    return chainId;
  }
  async getProvider() {
    let {
      chainId,
      create
    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    // Force create new provider
    if (!(0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider) || chainId || create) {
      const rpc = !this.options?.infuraId ? this.chains.reduce((rpc_, chain) => ({
        ...rpc_,
        [chain.chainId]: chain.rpc[0]
      }), {}) : {};
      const WalletConnectProvider = (await Promise.all(/*! import() */[__webpack_require__.e("vendors-node_modules_qrcode_lib_browser_js"), __webpack_require__.e("vendors-node_modules_preact_hooks_dist_hooks_module_js"), __webpack_require__.e("vendors-node_modules_thirdweb-dev_wallets_dist_index-42b0f5f5_browser_esm_js")]).then(__webpack_require__.bind(__webpack_require__, /*! ../../../../dist/index-42b0f5f5.browser.esm.js */ "./node_modules/@thirdweb-dev/wallets/dist/index-42b0f5f5.browser.esm.js"))).default;
      const sessionStr = await (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).getItem(LAST_SESSION);
      const session = sessionStr ? JSON.parse(sessionStr) : undefined;
      this.walletName = session?.peerMeta?.name || undefined;
      (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.a)(this, _provider, new WalletConnectProvider({
        ...this.options,
        chainId,
        rpc: {
          ...rpc,
          ...this.options?.rpc
        },
        session: session ? session : undefined
      }));
    }
    return (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider);
  }
  async getSigner() {
    let {
      chainId
    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    const [provider, account] = await Promise.all([this.getProvider({
      chainId
    }), this.getAccount()]);
    return new ethers__WEBPACK_IMPORTED_MODULE_8__.Web3Provider(provider, chainId).getSigner(account);
  }
  async isAuthorized() {
    try {
      const account = await this.getAccount();
      return !!account;
    } catch {
      return false;
    }
  }
  async switchChain(chainId) {
    const provider = await this.getProvider();
    const chainIdHex = ethers__WEBPACK_IMPORTED_MODULE_10__.hexValue(chainId);
    try {
      // Set up a race between `wallet_switchEthereumChain` & the `chainChanged` event
      // to ensure the chain has been switched. This is because there could be a case
      // where a wallet may not resolve the `wallet_switchEthereumChain` method, or
      // resolves slower than `chainChanged`.
      await Promise.race([provider.request({
        method: "wallet_switchEthereumChain",
        params: [{
          chainId: chainIdHex
        }]
      }), new Promise(res => this.on("change", _ref => {
        let {
          chain
        } = _ref;
        if (chain?.id === chainId) {
          res(chainId);
        }
      }))]);
      return this.chains.find(x => x.chainId === chainId) ?? {
        chainId: chainId,
        name: `Chain ${chainIdHex}`,
        network: `${chainIdHex}`,
        nativeCurrency: {
          name: "Ether",
          decimals: 18,
          symbol: "ETH"
        },
        rpc: [""],
        shortName: "eth",
        chain: "ETH",
        slug: "ethereum",
        testnet: false
      };
    } catch (error) {
      const message = typeof error === "string" ? error : error?.message;
      if (/user rejected request/i.test(message)) {
        throw new _dist_errors_105ad187_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.U(error);
      }
      const chain = this.chains.find(x => x.chainId === chainId);

      // if chain is not supported
      if (!chain) {
        throw new _dist_errors_105ad187_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.S(`Chain ${chainId} is not added in the list of supported chains`);
      }

      // if chain is not configured in the wallet
      if (/Unrecognized chain ID/i.test(message)) {
        // configure it
        this.emit("message", {
          type: "add_chain"
        });
        const blockExplorerUrls = this.getBlockExplorerUrls(chain);
        await provider.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: chainIdHex,
            chainName: chain.name,
            nativeCurrency: chain.nativeCurrency,
            rpcUrls: chain.rpc,
            blockExplorerUrls
          }]
        });
        return chain;
      } else {
        throw new _dist_errors_105ad187_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.S(error);
      }
    }
  }
  async setupListeners() {
    if (!(0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider)) {
      return;
    }
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("accountsChanged", this.onAccountsChanged);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("chainChanged", this.onChainChanged);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("disconnect", this.onDisconnect);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("message", this.onMessage);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("switchChain", this.onSwitchChain);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("display_uri", this.onDisplayUri);
    (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).on("call_request_sent", this.onRequestSent);
  }
}
async function _handleConnected2() {
  const session = (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider)?.connector.session;
  this.walletName = session?.peerMeta?.name || "";
  const sessionStr = JSON.stringify(session);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _storage).setItem(LAST_SESSION, sessionStr);
}
function _removeListeners2() {
  if (!(0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider)) {
    return;
  }
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("accountsChanged", this.onAccountsChanged);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("chainChanged", this.onChainChanged);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("disconnect", this.onDisconnect);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("message", this.onMessage);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("switchChain", this.onSwitchChain);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("display_uri", this.onDisplayUri);
  (0,_dist_classPrivateFieldSet_a5db7c83_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b)(this, _provider).removeListener("call_request_sent", this.onRequestSent);
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGhpcmR3ZWItZGV2X3dhbGxldHNfZXZtX2Nvbm5lY3RvcnNfd2FsbGV0LWNvbm5lY3QtdjFfZGlzdF90aGlyZHdlYi1kZXYtLWJkNmVmNC5idW5kbGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFnRjtBQUMzQjtBQUNaOztBQUV6Qyw2QkFBNkIscURBQVk7QUFDekM7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGVBQWUsK0RBQWE7QUFDNUI7QUFDQSxNQUFNO0FBQ047QUFDQSxJQUFJLDBFQUFlO0FBQ25CLElBQUksMEVBQWU7QUFDbkIsSUFBSSwwRUFBZTtBQUNuQixJQUFJLDBFQUFlO0FBQ25CLElBQUksMEVBQWU7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFK0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN6Q2lEOztBQUVoRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSwwRUFBZTtBQUNuQixJQUFJLDBFQUFlO0FBQ25CLElBQUksMEVBQWU7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksMEVBQWU7QUFDbkIsSUFBSSwwRUFBZTtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixvQkFBb0IsUUFBUSxrQ0FB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Q0EsU0FBUyxxRkFBcUI7QUFDOUI7QUFDQTtBQUNBLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCLElBQUkscUZBQXFCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixxRkFBcUI7QUFDdkM7QUFDQTtBQUNBLEVBQUUscUZBQXFCO0FBQ3ZCO0FBQ0E7QUFDQSxPQUFPLHFGQUFxQjtBQUM1QjtBQUNBO0FBQ0EsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkIsRUFBRSxxRkFBcUI7QUFDdkI7O0FBRW9DIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhpcmR3ZWItbGVhcm4tdGhlbWUvLi9ub2RlX21vZHVsZXMvQHRoaXJkd2ViLWRldi93YWxsZXRzL2Rpc3QvV2FnbWlDb25uZWN0b3ItNjBiMTk2MDQuYnJvd3Nlci5lc20uanMiLCJ3ZWJwYWNrOi8vdGhpcmR3ZWItbGVhcm4tdGhlbWUvLi9ub2RlX21vZHVsZXMvQHRoaXJkd2ViLWRldi93YWxsZXRzL2Rpc3QvZXJyb3JzLTEwNWFkMTg3LmJyb3dzZXIuZXNtLmpzIiwid2VicGFjazovL3RoaXJkd2ViLWxlYXJuLXRoZW1lLy4vbm9kZV9tb2R1bGVzL0B0aGlyZHdlYi1kZXYvd2FsbGV0cy9kaXN0L25vcm1hbGl6ZUNoYWluSWQtZTRjYzAxNzUuYnJvd3Nlci5lc20uanMiLCJ3ZWJwYWNrOi8vdGhpcmR3ZWItbGVhcm4tdGhlbWUvLi9ub2RlX21vZHVsZXMvQHRoaXJkd2ViLWRldi93YWxsZXRzL2V2bS9jb25uZWN0b3JzL3dhbGxldC1jb25uZWN0LXYxL2Rpc3QvdGhpcmR3ZWItZGV2LXdhbGxldHMtZXZtLWNvbm5lY3RvcnMtd2FsbGV0LWNvbm5lY3QtdjEuYnJvd3Nlci5lc20uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXyBhcyBfZGVmaW5lUHJvcGVydHkgfSBmcm9tICcuL2RlZmluZVByb3BlcnR5LWM4ZWNkYzA3LmJyb3dzZXIuZXNtLmpzJztcbmltcG9ydCB7IGRlZmF1bHRDaGFpbnMgfSBmcm9tICdAdGhpcmR3ZWItZGV2L2NoYWlucyc7XG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50ZW1pdHRlcjMnO1xuXG5jbGFzcyBXYWdtaUNvbm5lY3RvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIC8qKiBVbmlxdWUgY29ubmVjdG9yIGlkICovXG5cbiAgLyoqIENvbm5lY3RvciBuYW1lICovXG5cbiAgLyoqIENoYWlucyBjb25uZWN0b3Igc3VwcG9ydHMgKi9cblxuICAvKiogT3B0aW9ucyB0byB1c2Ugd2l0aCBjb25uZWN0b3IgKi9cblxuICAvKiogV2hldGhlciBjb25uZWN0b3IgaXMgdXNhYmxlICovXG5cbiAgY29uc3RydWN0b3IoX3JlZikge1xuICAgIGxldCB7XG4gICAgICBjaGFpbnMgPSBkZWZhdWx0Q2hhaW5zLFxuICAgICAgb3B0aW9uc1xuICAgIH0gPSBfcmVmO1xuICAgIHN1cGVyKCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiaWRcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJuYW1lXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY2hhaW5zXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwib3B0aW9uc1wiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlYWR5XCIsIHZvaWQgMCk7XG4gICAgdGhpcy5jaGFpbnMgPSBjaGFpbnM7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuICBnZXRCbG9ja0V4cGxvcmVyVXJscyhjaGFpbikge1xuICAgIGNvbnN0IGV4cGxvcmVycyA9IGNoYWluLmV4cGxvcmVycz8ubWFwKHggPT4geC51cmwpID8/IFtdO1xuICAgIHJldHVybiBleHBsb3JlcnMubGVuZ3RoID4gMCA/IGV4cGxvcmVycyA6IHVuZGVmaW5lZDtcbiAgfVxuICBpc0NoYWluVW5zdXBwb3J0ZWQoY2hhaW5JZCkge1xuICAgIHJldHVybiAhdGhpcy5jaGFpbnMuc29tZSh4ID0+IHguY2hhaW5JZCA9PT0gY2hhaW5JZCk7XG4gIH1cbiAgdXBkYXRlQ2hhaW5zKGNoYWlucykge1xuICAgIHRoaXMuY2hhaW5zID0gY2hhaW5zO1xuICB9XG59XG5cbmV4cG9ydCB7IFdhZ21pQ29ubmVjdG9yIGFzIFcgfTtcbiIsImltcG9ydCB7IF8gYXMgX2RlZmluZVByb3BlcnR5IH0gZnJvbSAnLi9kZWZpbmVQcm9wZXJ0eS1jOGVjZGMwNy5icm93c2VyLmVzbS5qcyc7XG5cbi8qKlxuICogRXJyb3Igc3ViY2xhc3MgaW1wbGVtZW50aW5nIEpTT04gUlBDIDIuMCBlcnJvcnMgYW5kIEV0aGVyZXVtIFJQQyBlcnJvcnMgcGVyIEVJUC0xNDc0LlxuICogQHNlZSBodHRwczovL2VpcHMuZXRoZXJldW0ub3JnL0VJUFMvZWlwLTE0NzRcbiAqL1xuY2xhc3MgUnBjRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKCAvKiogSHVtYW4tcmVhZGFibGUgc3RyaW5nICovXG4gIG1lc3NhZ2UsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7XG4gICAgICBjYXVzZSxcbiAgICAgIGNvZGUsXG4gICAgICBkYXRhXG4gICAgfSA9IG9wdGlvbnM7XG4gICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGNvZGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1wiY29kZVwiIG11c3QgYmUgYW4gaW50ZWdlci4nKTtcbiAgICB9XG4gICAgaWYgKCFtZXNzYWdlIHx8IHR5cGVvZiBtZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1wibWVzc2FnZVwiIG11c3QgYmUgYSBub25lbXB0eSBzdHJpbmcuJyk7XG4gICAgfVxuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNhdXNlXCIsIHZvaWQgMCk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwiY29kZVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRhdGFcIiwgdm9pZCAwKTtcbiAgICB0aGlzLmNhdXNlID0gY2F1c2U7XG4gICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICB9XG59XG5cbi8qKlxuICogRXJyb3Igc3ViY2xhc3MgaW1wbGVtZW50aW5nIEV0aGVyZXVtIFByb3ZpZGVyIGVycm9ycyBwZXIgRUlQLTExOTMuXG4gKiBAc2VlIGh0dHBzOi8vZWlwcy5ldGhlcmV1bS5vcmcvRUlQUy9laXAtMTE5M1xuICovXG5jbGFzcyBQcm92aWRlclJwY0Vycm9yIGV4dGVuZHMgUnBjRXJyb3Ige1xuICAvKipcbiAgICogQ3JlYXRlIGFuIEV0aGVyZXVtIFByb3ZpZGVyIEpTT04tUlBDIGVycm9yLlxuICAgKiBgY29kZWAgbXVzdCBiZSBhbiBpbnRlZ2VyIGluIHRoZSAxMDAwIDw9IDQ5OTkgcmFuZ2UuXG4gICAqL1xuICBjb25zdHJ1Y3RvciggLyoqIEh1bWFuLXJlYWRhYmxlIHN0cmluZyAqL1xuICBtZXNzYWdlLCBvcHRpb25zKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2F1c2UsXG4gICAgICBjb2RlLFxuICAgICAgZGF0YVxuICAgIH0gPSBvcHRpb25zO1xuICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA+PSAxMDAwICYmIGNvZGUgPD0gNDk5OSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignXCJjb2RlXCIgbXVzdCBiZSBhbiBpbnRlZ2VyIHN1Y2ggdGhhdDogMTAwMCA8PSBjb2RlIDw9IDQ5OTknKTtcbiAgICB9XG4gICAgc3VwZXIobWVzc2FnZSwge1xuICAgICAgY2F1c2UsXG4gICAgICBjb2RlLFxuICAgICAgZGF0YVxuICAgIH0pO1xuICB9XG59XG5jbGFzcyBBZGRDaGFpbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgXCJBZGRDaGFpbkVycm9yXCIpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1lc3NhZ2VcIiwgXCJFcnJvciBhZGRpbmcgY2hhaW5cIik7XG4gIH1cbn1cbmNsYXNzIENoYWluTm90Q29uZmlndXJlZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihfcmVmKSB7XG4gICAgbGV0IHtcbiAgICAgIGNoYWluSWQsXG4gICAgICBjb25uZWN0b3JJZFxuICAgIH0gPSBfcmVmO1xuICAgIHN1cGVyKGBDaGFpbiBcIiR7Y2hhaW5JZH1cIiBub3QgY29uZmlndXJlZCBmb3IgY29ubmVjdG9yIFwiJHtjb25uZWN0b3JJZH1cIi5gKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJuYW1lXCIsIFwiQ2hhaW5Ob3RDb25maWd1cmVkXCIpO1xuICB9XG59XG5jbGFzcyBDb25uZWN0b3JOb3RGb3VuZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgXCJDb25uZWN0b3JOb3RGb3VuZEVycm9yXCIpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1lc3NhZ2VcIiwgXCJDb25uZWN0b3Igbm90IGZvdW5kXCIpO1xuICB9XG59XG5jbGFzcyBSZXNvdXJjZVVuYXZhaWxhYmxlRXJyb3IgZXh0ZW5kcyBScGNFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlKSB7XG4gICAgc3VwZXIoXCJSZXNvdXJjZSB1bmF2YWlsYWJsZVwiLCB7XG4gICAgICBjYXVzZSxcbiAgICAgIGNvZGU6IC0zMjAwMlxuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgXCJSZXNvdXJjZVVuYXZhaWxhYmxlXCIpO1xuICB9XG59XG5jbGFzcyBTd2l0Y2hDaGFpbkVycm9yIGV4dGVuZHMgUHJvdmlkZXJScGNFcnJvciB7XG4gIGNvbnN0cnVjdG9yKGNhdXNlKSB7XG4gICAgc3VwZXIoXCJFcnJvciBzd2l0Y2hpbmcgY2hhaW5cIiwge1xuICAgICAgY2F1c2UsXG4gICAgICBjb2RlOiA0OTAyXG4gICAgfSk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwibmFtZVwiLCBcIlN3aXRjaENoYWluRXJyb3JcIik7XG4gIH1cbn1cbmNsYXNzIFVzZXJSZWplY3RlZFJlcXVlc3RFcnJvciBleHRlbmRzIFByb3ZpZGVyUnBjRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihjYXVzZSkge1xuICAgIHN1cGVyKFwiVXNlciByZWplY3RlZCByZXF1ZXN0XCIsIHtcbiAgICAgIGNhdXNlLFxuICAgICAgY29kZTogNDAwMVxuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwgXCJVc2VyUmVqZWN0ZWRSZXF1ZXN0RXJyb3JcIik7XG4gIH1cbn1cblxuLy8gRXRoZXJzIGRvZXMgbm90IGhhdmUgYW4gZXJyb3IgdHlwZSBzbyB3ZSBjYW4gdXNlIHRoaXMgZm9yIGNhc3Rpbmdcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcnMtaW8vZXRoZXJzLmpzL2Jsb2IvbWFpbi9wYWNrYWdlcy9sb2dnZXIvc3JjLnRzL2luZGV4LnRzI0wyNjhcblxuZXhwb3J0IHsgQWRkQ2hhaW5FcnJvciBhcyBBLCBDaGFpbk5vdENvbmZpZ3VyZWRFcnJvciBhcyBDLCBQcm92aWRlclJwY0Vycm9yIGFzIFAsIFJlc291cmNlVW5hdmFpbGFibGVFcnJvciBhcyBSLCBTd2l0Y2hDaGFpbkVycm9yIGFzIFMsIFVzZXJSZWplY3RlZFJlcXVlc3RFcnJvciBhcyBVLCBDb25uZWN0b3JOb3RGb3VuZEVycm9yIGFzIGEgfTtcbiIsImZ1bmN0aW9uIG5vcm1hbGl6ZUNoYWluSWQoY2hhaW5JZCkge1xuICBpZiAodHlwZW9mIGNoYWluSWQgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gTnVtYmVyLnBhcnNlSW50KGNoYWluSWQsIGNoYWluSWQudHJpbSgpLnN1YnN0cmluZygwLCAyKSA9PT0gXCIweFwiID8gMTYgOiAxMCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBjaGFpbklkID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIE51bWJlcihjaGFpbklkKTtcbiAgfVxuICByZXR1cm4gY2hhaW5JZDtcbn1cblxuZXhwb3J0IHsgbm9ybWFsaXplQ2hhaW5JZCBhcyBuIH07XG4iLCJpbXBvcnQgeyBfIGFzIF9jbGFzc1ByaXZhdGVNZXRob2RJbml0U3BlYywgYSBhcyBfY2xhc3NQcml2YXRlTWV0aG9kR2V0IH0gZnJvbSAnLi4vLi4vLi4vLi4vZGlzdC9jbGFzc1ByaXZhdGVNZXRob2RHZXQtZWExOTljYzMuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgXyBhcyBfY2xhc3NQcml2YXRlRmllbGRJbml0U3BlYywgYiBhcyBfY2xhc3NQcml2YXRlRmllbGRHZXQsIGEgYXMgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0IH0gZnJvbSAnLi4vLi4vLi4vLi4vZGlzdC9jbGFzc1ByaXZhdGVGaWVsZFNldC1hNWRiN2M4My5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBfIGFzIF9kZWZpbmVQcm9wZXJ0eSB9IGZyb20gJy4uLy4uLy4uLy4uL2Rpc3QvZGVmaW5lUHJvcGVydHktYzhlY2RjMDcuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgdyBhcyB3YWxsZXRJZHMgfSBmcm9tICcuLi8uLi8uLi8uLi9kaXN0L3dhbGxldElkcy0xZWE5NzQxMS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyB1dGlscywgcHJvdmlkZXJzIH0gZnJvbSAnZXRoZXJzJztcbmltcG9ydCB7IFcgYXMgV2FnbWlDb25uZWN0b3IgfSBmcm9tICcuLi8uLi8uLi8uLi9kaXN0L1dhZ21pQ29ubmVjdG9yLTYwYjE5NjA0LmJyb3dzZXIuZXNtLmpzJztcbmltcG9ydCB7IG4gYXMgbm9ybWFsaXplQ2hhaW5JZCB9IGZyb20gJy4uLy4uLy4uLy4uL2Rpc3Qvbm9ybWFsaXplQ2hhaW5JZC1lNGNjMDE3NS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBVIGFzIFVzZXJSZWplY3RlZFJlcXVlc3RFcnJvciwgUyBhcyBTd2l0Y2hDaGFpbkVycm9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vZGlzdC9lcnJvcnMtMTA1YWQxODcuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NoYWlucyc7XG5pbXBvcnQgJ2V2ZW50ZW1pdHRlcjMnO1xuXG4vKipcbiAqIFdhbGxldHMgdGhhdCBzdXBwb3J0IGNoYWluIHN3aXRjaGluZyB0aHJvdWdoIFdhbGxldENvbm5lY3RcbiAqIC0gaW1Ub2tlbiAodG9rZW4uaW0pXG4gKiAtIE1ldGFNYXNrIChtZXRhbWFzay5pbylcbiAqIC0gUmFpbmJvdyAocmFpbmJvdy5tZSlcbiAqIC0gVHJ1c3QgV2FsbGV0ICh0cnVzdHdhbGxldC5jb20pXG4gKi9cbi8vIGNvbnN0IHN3aXRjaENoYWluQWxsb3dlZFJlZ2V4ID0gLyhpbXRva2VufG1ldGFtYXNrfHJhaW5ib3d8dHJ1c3Qgd2FsbGV0KS9pO1xuXG5jb25zdCBMQVNUX1VTRURfQ0hBSU5fSUQgPSBcImxhc3QtdXNlZC1jaGFpbi1pZFwiO1xuY29uc3QgTEFTVF9TRVNTSU9OID0gXCJsYXN0LXNlc3Npb25cIjtcbnZhciBfcHJvdmlkZXIgPSAvKiNfX1BVUkVfXyovbmV3IFdlYWtNYXAoKTtcbnZhciBfc3RvcmFnZSA9IC8qI19fUFVSRV9fKi9uZXcgV2Vha01hcCgpO1xudmFyIF9oYW5kbGVDb25uZWN0ZWQgPSAvKiNfX1BVUkVfXyovbmV3IFdlYWtTZXQoKTtcbnZhciBfcmVtb3ZlTGlzdGVuZXJzID0gLyojX19QVVJFX18qL25ldyBXZWFrU2V0KCk7XG5jbGFzcyBXYWxsZXRDb25uZWN0VjFDb25uZWN0b3IgZXh0ZW5kcyBXYWdtaUNvbm5lY3RvciB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgIHN1cGVyKGNvbmZpZyk7XG4gICAgX2NsYXNzUHJpdmF0ZU1ldGhvZEluaXRTcGVjKHRoaXMsIF9yZW1vdmVMaXN0ZW5lcnMpO1xuICAgIF9jbGFzc1ByaXZhdGVNZXRob2RJbml0U3BlYyh0aGlzLCBfaGFuZGxlQ29ubmVjdGVkKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJpZFwiLCB3YWxsZXRJZHMud2FsbGV0Q29ubmVjdFYxKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJuYW1lXCIsIFwiV2FsbGV0Q29ubmVjdFYxXCIpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlYWR5XCIsIHRydWUpO1xuICAgIF9jbGFzc1ByaXZhdGVGaWVsZEluaXRTcGVjKHRoaXMsIF9wcm92aWRlciwge1xuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogdm9pZCAwXG4gICAgfSk7XG4gICAgX2NsYXNzUHJpdmF0ZUZpZWxkSW5pdFNwZWModGhpcywgX3N0b3JhZ2UsIHtcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgdmFsdWU6IHZvaWQgMFxuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIndhbGxldE5hbWVcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJvblN3aXRjaENoYWluXCIsICgpID0+IHtcbiAgICAgIHRoaXMuZW1pdChcIm1lc3NhZ2VcIiwge1xuICAgICAgICB0eXBlOiBcInN3aXRjaF9jaGFpblwiXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJvbkRpc3BsYXlVcmlcIiwgYXN5bmMgKGVycm9yLCBwYXlsb2FkKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgICAgZGF0YTogZXJyb3IsXG4gICAgICAgICAgdHlwZTogXCJkaXNwbGF5X3VyaV9lcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgIGRhdGE6IHBheWxvYWQucGFyYW1zWzBdLFxuICAgICAgICB0eXBlOiBcImRpc3BsYXlfdXJpXCJcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9uUmVxdWVzdFNlbnRcIiwgKGVycm9yLCBwYXlsb2FkKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgICAgZGF0YTogZXJyb3IsXG4gICAgICAgICAgdHlwZTogXCJyZXF1ZXN0XCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLmVtaXQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgZGF0YTogcGF5bG9hZC5wYXJhbXNbMF0sXG4gICAgICAgIHR5cGU6IFwicmVxdWVzdFwiXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJvbk1lc3NhZ2VcIiwgbWVzc2FnZSA9PiB7XG4gICAgICB0aGlzLmVtaXQoXCJtZXNzYWdlXCIsIG1lc3NhZ2UpO1xuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9uQWNjb3VudHNDaGFuZ2VkXCIsIGFjY291bnRzID0+IHtcbiAgICAgIGlmIChhY2NvdW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiZGlzY29ubmVjdFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1pdChcImNoYW5nZVwiLCB7XG4gICAgICAgICAgYWNjb3VudDogdXRpbHMuZ2V0QWRkcmVzcyhhY2NvdW50c1swXSlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgX2RlZmluZVByb3BlcnR5KHRoaXMsIFwib25DaGFpbkNoYW5nZWRcIiwgY2hhaW5JZCA9PiB7XG4gICAgICBjb25zdCBpZCA9IG5vcm1hbGl6ZUNoYWluSWQoY2hhaW5JZCk7XG4gICAgICBjb25zdCB1bnN1cHBvcnRlZCA9IHRoaXMuaXNDaGFpblVuc3VwcG9ydGVkKGlkKTtcbiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfc3RvcmFnZSkuc2V0SXRlbShMQVNUX1VTRURfQ0hBSU5fSUQsIFN0cmluZyhjaGFpbklkKSk7XG4gICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIiwge1xuICAgICAgICBjaGFpbjoge1xuICAgICAgICAgIGlkLFxuICAgICAgICAgIHVuc3VwcG9ydGVkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm9uRGlzY29ubmVjdFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLndhbGxldE5hbWUgPSB1bmRlZmluZWQ7XG4gICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3N0b3JhZ2UpLnJlbW92ZUl0ZW0oTEFTVF9VU0VEX0NIQUlOX0lEKTtcbiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfc3RvcmFnZSkucmVtb3ZlSXRlbShMQVNUX1NFU1NJT04pO1xuICAgICAgX2NsYXNzUHJpdmF0ZU1ldGhvZEdldCh0aGlzLCBfcmVtb3ZlTGlzdGVuZXJzLCBfcmVtb3ZlTGlzdGVuZXJzMikuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMuZW1pdChcImRpc2Nvbm5lY3RcIik7XG4gICAgfSk7XG4gICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9zdG9yYWdlLCBjb25maWcuc3RvcmFnZSk7XG4gIH1cbiAgYXN5bmMgY29ubmVjdCgpIHtcbiAgICBsZXQge1xuICAgICAgY2hhaW5JZFxuICAgIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgIHRyeSB7XG4gICAgICBsZXQgdGFyZ2V0Q2hhaW5JZCA9IGNoYWluSWQ7XG4gICAgICBpZiAoIXRhcmdldENoYWluSWQpIHtcbiAgICAgICAgY29uc3QgbGFzdFVzZWRDaGFpbklkU3RyID0gYXdhaXQgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9zdG9yYWdlKS5nZXRJdGVtKExBU1RfVVNFRF9DSEFJTl9JRCk7XG4gICAgICAgIGNvbnN0IGxhc3RVc2VkQ2hhaW5JZCA9IGxhc3RVc2VkQ2hhaW5JZFN0ciA/IHBhcnNlSW50KGxhc3RVc2VkQ2hhaW5JZFN0cikgOiB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChsYXN0VXNlZENoYWluSWQgJiYgIXRoaXMuaXNDaGFpblVuc3VwcG9ydGVkKGxhc3RVc2VkQ2hhaW5JZCkpIHtcbiAgICAgICAgICB0YXJnZXRDaGFpbklkID0gbGFzdFVzZWRDaGFpbklkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBwcm92aWRlciA9IGF3YWl0IHRoaXMuZ2V0UHJvdmlkZXIoe1xuICAgICAgICBjaGFpbklkOiB0YXJnZXRDaGFpbklkLFxuICAgICAgICBjcmVhdGU6IHRydWVcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zZXR1cExpc3RlbmVycygpO1xuXG4gICAgICAvLyBEZWZlciBtZXNzYWdlIHRvIHRoZSBuZXh0IHRpY2sgdG8gZW5zdXJlIHdhbGxldCBjb25uZWN0IGRhdGEgKHByb3ZpZGVkIGJ5IGAuZW5hYmxlKClgKSBpcyBhdmFpbGFibGVcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5lbWl0KFwibWVzc2FnZVwiLCB7XG4gICAgICAgIHR5cGU6IFwiY29ubmVjdGluZ1wiXG4gICAgICB9KSwgMCk7XG4gICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IHByb3ZpZGVyLmVuYWJsZSgpO1xuICAgICAgY29uc3QgYWNjb3VudCA9IHV0aWxzLmdldEFkZHJlc3MoYWNjb3VudHNbMF0pO1xuICAgICAgbGV0IGlkID0gYXdhaXQgdGhpcy5nZXRDaGFpbklkKCk7XG4gICAgICBsZXQgdW5zdXBwb3J0ZWQgPSB0aGlzLmlzQ2hhaW5VbnN1cHBvcnRlZChpZCk7XG5cbiAgICAgIC8vIE5vdCBhbGwgV2FsbGV0Q29ubmVjdCBvcHRpb25zIHN1cHBvcnQgcHJvZ3JhbW1hdGljIGNoYWluIHN3aXRjaGluZ1xuICAgICAgLy8gT25seSBlbmFibGUgZm9yIHdhbGxldCBvcHRpb25zIHRoYXQgZG9cbiAgICAgIHRoaXMud2FsbGV0TmFtZSA9IHByb3ZpZGVyLmNvbm5lY3Rvcj8ucGVlck1ldGE/Lm5hbWUgPz8gXCJcIjtcblxuICAgICAgLy8gc3dpdGNoIHRvIHRhcmdldCBjaGFpbklkXG4gICAgICBpZiAoY2hhaW5JZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuc3dpdGNoQ2hhaW4oY2hhaW5JZCk7XG4gICAgICAgICAgaWQgPSBjaGFpbklkO1xuICAgICAgICAgIHVuc3VwcG9ydGVkID0gdGhpcy5pc0NoYWluVW5zdXBwb3J0ZWQoaWQpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgY291bGQgbm90IHN3aXRjaCB0byBkZXNpcmVkIGNoYWluIGlkOiAke2NoYWluSWR9IGAsIGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBfY2xhc3NQcml2YXRlTWV0aG9kR2V0KHRoaXMsIF9oYW5kbGVDb25uZWN0ZWQsIF9oYW5kbGVDb25uZWN0ZWQyKS5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5lbWl0KFwiY29ubmVjdFwiLCB7XG4gICAgICAgIGFjY291bnQsXG4gICAgICAgIGNoYWluOiB7XG4gICAgICAgICAgaWQsXG4gICAgICAgICAgdW5zdXBwb3J0ZWRcbiAgICAgICAgfSxcbiAgICAgICAgcHJvdmlkZXJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWNjb3VudCxcbiAgICAgICAgY2hhaW46IHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICB1bnN1cHBvcnRlZFxuICAgICAgICB9LFxuICAgICAgICBwcm92aWRlcjogbmV3IHByb3ZpZGVycy5XZWIzUHJvdmlkZXIocHJvdmlkZXIpXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoL3VzZXIgY2xvc2VkIG1vZGFsL2kudGVzdChlcnJvci5tZXNzYWdlKSkge1xuICAgICAgICB0aHJvdyBuZXcgVXNlclJlamVjdGVkUmVxdWVzdEVycm9yKGVycm9yKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBhc3luYyBkaXNjb25uZWN0KCkge1xuICAgIGNvbnN0IHByb3ZpZGVyID0gYXdhaXQgdGhpcy5nZXRQcm92aWRlcigpO1xuICAgIGF3YWl0IHByb3ZpZGVyLmRpc2Nvbm5lY3QoKTtcbiAgfVxuICBhc3luYyBnZXRBY2NvdW50KCkge1xuICAgIGNvbnN0IHByb3ZpZGVyID0gYXdhaXQgdGhpcy5nZXRQcm92aWRlcigpO1xuICAgIGNvbnN0IGFjY291bnRzID0gcHJvdmlkZXIuYWNjb3VudHM7XG4gICAgLy8gcmV0dXJuIGNoZWNrc3VtIGFkZHJlc3NcbiAgICByZXR1cm4gdXRpbHMuZ2V0QWRkcmVzcyhhY2NvdW50c1swXSk7XG4gIH1cbiAgYXN5bmMgZ2V0Q2hhaW5JZCgpIHtcbiAgICBjb25zdCBwcm92aWRlciA9IGF3YWl0IHRoaXMuZ2V0UHJvdmlkZXIoKTtcbiAgICBjb25zdCBjaGFpbklkID0gbm9ybWFsaXplQ2hhaW5JZChwcm92aWRlci5jaGFpbklkKTtcbiAgICByZXR1cm4gY2hhaW5JZDtcbiAgfVxuICBhc3luYyBnZXRQcm92aWRlcigpIHtcbiAgICBsZXQge1xuICAgICAgY2hhaW5JZCxcbiAgICAgIGNyZWF0ZVxuICAgIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgIC8vIEZvcmNlIGNyZWF0ZSBuZXcgcHJvdmlkZXJcbiAgICBpZiAoIV9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcHJvdmlkZXIpIHx8IGNoYWluSWQgfHwgY3JlYXRlKSB7XG4gICAgICBjb25zdCBycGMgPSAhdGhpcy5vcHRpb25zPy5pbmZ1cmFJZCA/IHRoaXMuY2hhaW5zLnJlZHVjZSgocnBjXywgY2hhaW4pID0+ICh7XG4gICAgICAgIC4uLnJwY18sXG4gICAgICAgIFtjaGFpbi5jaGFpbklkXTogY2hhaW4ucnBjWzBdXG4gICAgICB9KSwge30pIDoge307XG4gICAgICBjb25zdCBXYWxsZXRDb25uZWN0UHJvdmlkZXIgPSAoYXdhaXQgaW1wb3J0KCcuLi8uLi8uLi8uLi9kaXN0L2luZGV4LTQyYjBmNWY1LmJyb3dzZXIuZXNtLmpzJykpLmRlZmF1bHQ7XG4gICAgICBjb25zdCBzZXNzaW9uU3RyID0gYXdhaXQgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9zdG9yYWdlKS5nZXRJdGVtKExBU1RfU0VTU0lPTik7XG4gICAgICBjb25zdCBzZXNzaW9uID0gc2Vzc2lvblN0ciA/IEpTT04ucGFyc2Uoc2Vzc2lvblN0cikgOiB1bmRlZmluZWQ7XG4gICAgICB0aGlzLndhbGxldE5hbWUgPSBzZXNzaW9uPy5wZWVyTWV0YT8ubmFtZSB8fCB1bmRlZmluZWQ7XG4gICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX3Byb3ZpZGVyLCBuZXcgV2FsbGV0Q29ubmVjdFByb3ZpZGVyKHtcbiAgICAgICAgLi4udGhpcy5vcHRpb25zLFxuICAgICAgICBjaGFpbklkLFxuICAgICAgICBycGM6IHtcbiAgICAgICAgICAuLi5ycGMsXG4gICAgICAgICAgLi4udGhpcy5vcHRpb25zPy5ycGNcbiAgICAgICAgfSxcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbiA/IHNlc3Npb24gOiB1bmRlZmluZWRcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcHJvdmlkZXIpO1xuICB9XG4gIGFzeW5jIGdldFNpZ25lcigpIHtcbiAgICBsZXQge1xuICAgICAgY2hhaW5JZFxuICAgIH0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgIGNvbnN0IFtwcm92aWRlciwgYWNjb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5nZXRQcm92aWRlcih7XG4gICAgICBjaGFpbklkXG4gICAgfSksIHRoaXMuZ2V0QWNjb3VudCgpXSk7XG4gICAgcmV0dXJuIG5ldyBwcm92aWRlcnMuV2ViM1Byb3ZpZGVyKHByb3ZpZGVyLCBjaGFpbklkKS5nZXRTaWduZXIoYWNjb3VudCk7XG4gIH1cbiAgYXN5bmMgaXNBdXRob3JpemVkKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgdGhpcy5nZXRBY2NvdW50KCk7XG4gICAgICByZXR1cm4gISFhY2NvdW50O1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBhc3luYyBzd2l0Y2hDaGFpbihjaGFpbklkKSB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBhd2FpdCB0aGlzLmdldFByb3ZpZGVyKCk7XG4gICAgY29uc3QgY2hhaW5JZEhleCA9IHV0aWxzLmhleFZhbHVlKGNoYWluSWQpO1xuICAgIHRyeSB7XG4gICAgICAvLyBTZXQgdXAgYSByYWNlIGJldHdlZW4gYHdhbGxldF9zd2l0Y2hFdGhlcmV1bUNoYWluYCAmIHRoZSBgY2hhaW5DaGFuZ2VkYCBldmVudFxuICAgICAgLy8gdG8gZW5zdXJlIHRoZSBjaGFpbiBoYXMgYmVlbiBzd2l0Y2hlZC4gVGhpcyBpcyBiZWNhdXNlIHRoZXJlIGNvdWxkIGJlIGEgY2FzZVxuICAgICAgLy8gd2hlcmUgYSB3YWxsZXQgbWF5IG5vdCByZXNvbHZlIHRoZSBgd2FsbGV0X3N3aXRjaEV0aGVyZXVtQ2hhaW5gIG1ldGhvZCwgb3JcbiAgICAgIC8vIHJlc29sdmVzIHNsb3dlciB0aGFuIGBjaGFpbkNoYW5nZWRgLlxuICAgICAgYXdhaXQgUHJvbWlzZS5yYWNlKFtwcm92aWRlci5yZXF1ZXN0KHtcbiAgICAgICAgbWV0aG9kOiBcIndhbGxldF9zd2l0Y2hFdGhlcmV1bUNoYWluXCIsXG4gICAgICAgIHBhcmFtczogW3tcbiAgICAgICAgICBjaGFpbklkOiBjaGFpbklkSGV4XG4gICAgICAgIH1dXG4gICAgICB9KSwgbmV3IFByb21pc2UocmVzID0+IHRoaXMub24oXCJjaGFuZ2VcIiwgX3JlZiA9PiB7XG4gICAgICAgIGxldCB7XG4gICAgICAgICAgY2hhaW5cbiAgICAgICAgfSA9IF9yZWY7XG4gICAgICAgIGlmIChjaGFpbj8uaWQgPT09IGNoYWluSWQpIHtcbiAgICAgICAgICByZXMoY2hhaW5JZCk7XG4gICAgICAgIH1cbiAgICAgIH0pKV0pO1xuICAgICAgcmV0dXJuIHRoaXMuY2hhaW5zLmZpbmQoeCA9PiB4LmNoYWluSWQgPT09IGNoYWluSWQpID8/IHtcbiAgICAgICAgY2hhaW5JZDogY2hhaW5JZCxcbiAgICAgICAgbmFtZTogYENoYWluICR7Y2hhaW5JZEhleH1gLFxuICAgICAgICBuZXR3b3JrOiBgJHtjaGFpbklkSGV4fWAsXG4gICAgICAgIG5hdGl2ZUN1cnJlbmN5OiB7XG4gICAgICAgICAgbmFtZTogXCJFdGhlclwiLFxuICAgICAgICAgIGRlY2ltYWxzOiAxOCxcbiAgICAgICAgICBzeW1ib2w6IFwiRVRIXCJcbiAgICAgICAgfSxcbiAgICAgICAgcnBjOiBbXCJcIl0sXG4gICAgICAgIHNob3J0TmFtZTogXCJldGhcIixcbiAgICAgICAgY2hhaW46IFwiRVRIXCIsXG4gICAgICAgIHNsdWc6IFwiZXRoZXJldW1cIixcbiAgICAgICAgdGVzdG5ldDogZmFsc2VcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyb3IgPT09IFwic3RyaW5nXCIgPyBlcnJvciA6IGVycm9yPy5tZXNzYWdlO1xuICAgICAgaWYgKC91c2VyIHJlamVjdGVkIHJlcXVlc3QvaS50ZXN0KG1lc3NhZ2UpKSB7XG4gICAgICAgIHRocm93IG5ldyBVc2VyUmVqZWN0ZWRSZXF1ZXN0RXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgICAgY29uc3QgY2hhaW4gPSB0aGlzLmNoYWlucy5maW5kKHggPT4geC5jaGFpbklkID09PSBjaGFpbklkKTtcblxuICAgICAgLy8gaWYgY2hhaW4gaXMgbm90IHN1cHBvcnRlZFxuICAgICAgaWYgKCFjaGFpbikge1xuICAgICAgICB0aHJvdyBuZXcgU3dpdGNoQ2hhaW5FcnJvcihgQ2hhaW4gJHtjaGFpbklkfSBpcyBub3QgYWRkZWQgaW4gdGhlIGxpc3Qgb2Ygc3VwcG9ydGVkIGNoYWluc2ApO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiBjaGFpbiBpcyBub3QgY29uZmlndXJlZCBpbiB0aGUgd2FsbGV0XG4gICAgICBpZiAoL1VucmVjb2duaXplZCBjaGFpbiBJRC9pLnRlc3QobWVzc2FnZSkpIHtcbiAgICAgICAgLy8gY29uZmlndXJlIGl0XG4gICAgICAgIHRoaXMuZW1pdChcIm1lc3NhZ2VcIiwge1xuICAgICAgICAgIHR5cGU6IFwiYWRkX2NoYWluXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGJsb2NrRXhwbG9yZXJVcmxzID0gdGhpcy5nZXRCbG9ja0V4cGxvcmVyVXJscyhjaGFpbik7XG4gICAgICAgIGF3YWl0IHByb3ZpZGVyLnJlcXVlc3Qoe1xuICAgICAgICAgIG1ldGhvZDogXCJ3YWxsZXRfYWRkRXRoZXJldW1DaGFpblwiLFxuICAgICAgICAgIHBhcmFtczogW3tcbiAgICAgICAgICAgIGNoYWluSWQ6IGNoYWluSWRIZXgsXG4gICAgICAgICAgICBjaGFpbk5hbWU6IGNoYWluLm5hbWUsXG4gICAgICAgICAgICBuYXRpdmVDdXJyZW5jeTogY2hhaW4ubmF0aXZlQ3VycmVuY3ksXG4gICAgICAgICAgICBycGNVcmxzOiBjaGFpbi5ycGMsXG4gICAgICAgICAgICBibG9ja0V4cGxvcmVyVXJsc1xuICAgICAgICAgIH1dXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY2hhaW47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgU3dpdGNoQ2hhaW5FcnJvcihlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGFzeW5jIHNldHVwTGlzdGVuZXJzKCkge1xuICAgIGlmICghX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikub24oXCJhY2NvdW50c0NoYW5nZWRcIiwgdGhpcy5vbkFjY291bnRzQ2hhbmdlZCk7XG4gICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikub24oXCJjaGFpbkNoYW5nZWRcIiwgdGhpcy5vbkNoYWluQ2hhbmdlZCk7XG4gICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikub24oXCJkaXNjb25uZWN0XCIsIHRoaXMub25EaXNjb25uZWN0KTtcbiAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5vbihcIm1lc3NhZ2VcIiwgdGhpcy5vbk1lc3NhZ2UpO1xuICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcHJvdmlkZXIpLm9uKFwic3dpdGNoQ2hhaW5cIiwgdGhpcy5vblN3aXRjaENoYWluKTtcbiAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5vbihcImRpc3BsYXlfdXJpXCIsIHRoaXMub25EaXNwbGF5VXJpKTtcbiAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5vbihcImNhbGxfcmVxdWVzdF9zZW50XCIsIHRoaXMub25SZXF1ZXN0U2VudCk7XG4gIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIF9oYW5kbGVDb25uZWN0ZWQyKCkge1xuICBjb25zdCBzZXNzaW9uID0gX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcik/LmNvbm5lY3Rvci5zZXNzaW9uO1xuICB0aGlzLndhbGxldE5hbWUgPSBzZXNzaW9uPy5wZWVyTWV0YT8ubmFtZSB8fCBcIlwiO1xuICBjb25zdCBzZXNzaW9uU3RyID0gSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbik7XG4gIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfc3RvcmFnZSkuc2V0SXRlbShMQVNUX1NFU1NJT04sIHNlc3Npb25TdHIpO1xufVxuZnVuY3Rpb24gX3JlbW92ZUxpc3RlbmVyczIoKSB7XG4gIGlmICghX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9wcm92aWRlcikucmVtb3ZlTGlzdGVuZXIoXCJhY2NvdW50c0NoYW5nZWRcIiwgdGhpcy5vbkFjY291bnRzQ2hhbmdlZCk7XG4gIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcHJvdmlkZXIpLnJlbW92ZUxpc3RlbmVyKFwiY2hhaW5DaGFuZ2VkXCIsIHRoaXMub25DaGFpbkNoYW5nZWQpO1xuICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5yZW1vdmVMaXN0ZW5lcihcImRpc2Nvbm5lY3RcIiwgdGhpcy5vbkRpc2Nvbm5lY3QpO1xuICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5yZW1vdmVMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgdGhpcy5vbk1lc3NhZ2UpO1xuICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5yZW1vdmVMaXN0ZW5lcihcInN3aXRjaENoYWluXCIsIHRoaXMub25Td2l0Y2hDaGFpbik7XG4gIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcHJvdmlkZXIpLnJlbW92ZUxpc3RlbmVyKFwiZGlzcGxheV91cmlcIiwgdGhpcy5vbkRpc3BsYXlVcmkpO1xuICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Byb3ZpZGVyKS5yZW1vdmVMaXN0ZW5lcihcImNhbGxfcmVxdWVzdF9zZW50XCIsIHRoaXMub25SZXF1ZXN0U2VudCk7XG59XG5cbmV4cG9ydCB7IFdhbGxldENvbm5lY3RWMUNvbm5lY3RvciB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9