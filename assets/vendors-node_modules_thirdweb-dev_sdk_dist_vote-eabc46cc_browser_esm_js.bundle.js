"use strict";
(self["webpackChunkthirdweb_learn_theme"] = self["webpackChunkthirdweb_learn_theme"] || []).push([["vendors-node_modules_thirdweb-dev_sdk_dist_vote-eabc46cc_browser_esm_js"],{

/***/ "./node_modules/@thirdweb-dev/sdk/dist/vote-eabc46cc.browser.esm.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/sdk/dist/vote-eabc46cc.browser.esm.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Vote: () => (/* binding */ Vote)
/* harmony export */ });
/* harmony import */ var _QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./QueryParams-7d9473b5.browser.esm.js */ "./node_modules/@thirdweb-dev/sdk/dist/QueryParams-7d9473b5.browser.esm.js");
/* harmony import */ var _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./contract-metadata-88f06ef9.browser.esm.js */ "./node_modules/@thirdweb-dev/sdk/dist/contract-metadata-88f06ef9.browser.esm.js");
/* harmony import */ var _thirdweb_dev_contracts_js_dist_abis_IERC20_json__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @thirdweb-dev/contracts-js/dist/abis/IERC20.json */ "./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC20.json");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/hash/lib.esm/id.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/units/lib.esm/index.js");
/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ethers */ "./node_modules/@ethersproject/contracts/lib.esm/index.js");
/* harmony import */ var _Vote_3b66775c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Vote-3b66775c.browser.esm.js */ "./node_modules/@thirdweb-dev/sdk/dist/Vote-3b66775c.browser.esm.js");
/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bn.js */ "./node_modules/bn.js/lib/bn.js");
/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bn_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tiny_invariant__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tiny-invariant */ "./node_modules/tiny-invariant/dist/esm/tiny-invariant.js");
/* harmony import */ var eventemitter3__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! eventemitter3 */ "./node_modules/eventemitter3/index.mjs");
/* harmony import */ var cross_fetch__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! cross-fetch */ "./node_modules/cross-fetch/dist/browser-ponyfill.js");
/* harmony import */ var cross_fetch__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(cross_fetch__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var merkletreejs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! merkletreejs */ "./node_modules/merkletreejs/dist/index.js");
/* harmony import */ var merkletreejs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(merkletreejs__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! fast-deep-equal */ "./node_modules/fast-deep-equal/index.js");
/* harmony import */ var fast_deep_equal__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(fast_deep_equal__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! bs58 */ "./node_modules/bs58/index.js");
/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(bs58__WEBPACK_IMPORTED_MODULE_6__);














































































/**
 * Create a decentralized organization for token holders to vote on proposals.
 *
 * @example
 *
 * ```javascript
 * import { ThirdwebSDK } from "@thirdweb-dev/sdk";
 *
 * const sdk = new ThirdwebSDK("{{chainName}}");
 * const contract = await sdk.getContract("{{contract_address}}", "vote");
 * ```
 *
 * @public
 */
class Vote {
  /**
   * @internal
   */

  get chainId() {
    return this._chainId;
  }
  constructor(network, address, storage) {
    var _this = this;
    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
    let abi = arguments.length > 4 ? arguments[4] : undefined;
    let chainId = arguments.length > 5 ? arguments[5] : undefined;
    let contractWrapper = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.dz(network, address, abi, options);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "contractWrapper", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "storage", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "abi", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "metadata", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "app", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "encoder", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "estimator", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "events", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "interceptor", void 0);
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "_chainId", void 0);
    /** ******************************
     * WRITE FUNCTIONS
     *******************************/
    /**
     * Create Proposal
     *
     * @remarks Create a new proposal for token holders to vote on.
     *
     * @example
     * ```javascript
     * // The description of the proposal you want to pass
     * const description = "This is a great proposal - vote for it!"
     * // You can (optionally) pass in contract calls that will get executed when the proposal is executed.
     * const executions = [
     *   {
     *     // The contract you want to make a call to
     *     toAddress: "0x...",
     *     // The amount of the native currency to send in this transaction
     *     nativeTokenValue: 0,
     *     // Transaction data that will be executed when the proposal is executed
     *     // This is an example transfer transaction with a token contract (which you would need to set up in code)
     *     transactionData: tokenContract.encoder.encode(
     *       "transfer", [
     *         fromAddress,
     *         amount,
     *       ]
     *     ),
     *   }
     * ]
     *
     * const proposal = await contract.propose(description, executions);
     * ```
     *
     * @param description - The description of the proposal.
     * @param executions - A set of executable transactions that will be run if the proposal is passed and executed.
     * @returns - The id of the created proposal and the transaction receipt.
     */
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "propose", (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.ds)(async (description, executions) => {
      if (!executions) {
        executions = [{
          toAddress: this.contractWrapper.readContract.address,
          nativeTokenValue: 0,
          transactionData: "0x"
        }];
      }
      const tos = executions.map(p => p.toAddress);
      const values = executions.map(p => p.nativeTokenValue);
      const datas = executions.map(p => p.transactionData);
      return _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aV.fromContractWrapper({
        contractWrapper: this.contractWrapper,
        method: "propose",
        args: [tos, values, datas, description],
        parse: receipt => {
          const event = this.contractWrapper.parseLogs("ProposalCreated", receipt?.logs);
          return {
            id: event[0].args.proposalId,
            receipt
          };
        }
      });
    }));
    /**
     * Vote
     *
     * @remarks Vote on an active proposal
     *
     * @example
     * ```javascript
     * // The proposal ID of the proposal you want to vote on
     * const proposalId = "0";
     * // The vote type you want to cast, can be VoteType.Against, VoteType.For, or VoteType.Abstain
     * const voteType = VoteType.For;
     * // The (optional) reason for the vote
     * const reason = "I like this proposal!";
     *
     * await contract.vote(proposalId, voteType, reason);
     * ```
     * @param proposalId - The proposal to cast a vote on.
     * @param voteType - The position the voter is taking on their vote.
     * @param reason - (optional) The reason for the vote.
     */
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "vote", (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.ds)(async function (proposalId, voteType) {
      let reason = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";
      await _this.ensureExists(proposalId);
      return _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aV.fromContractWrapper({
        contractWrapper: _this.contractWrapper,
        method: "castVoteWithReason",
        args: [proposalId, voteType, reason]
      });
    }));
    /**
     * Execute Proposal
     *
     * @remarks Execute the related transactions for a proposal if the proposal succeeded.
     *
     * @example
     * ```javascript
     * // The proposal ID of the proposal you want to execute
     * const proposalId = "0"
     * await contract.execute(proposalId);
     * ```
     *
     * @param proposalId - The proposal id to execute.
     */
    (0,_QueryParams_7d9473b5_browser_esm_js__WEBPACK_IMPORTED_MODULE_8__._)(this, "execute", (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.ds)(async proposalId => {
      await this.ensureExists(proposalId);
      const proposal = await this.get(proposalId);
      const tos = proposal.executions.map(p => p.toAddress);
      const values = proposal.executions.map(p => p.nativeTokenValue);
      const datas = proposal.executions.map(p => p.transactionData);
      const descriptionHash = ethers__WEBPACK_IMPORTED_MODULE_9__.id(proposal.description);
      return _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aV.fromContractWrapper({
        contractWrapper: this.contractWrapper,
        method: "execute",
        args: [tos, values, datas, descriptionHash]
      });
    }));
    this._chainId = chainId;
    this.abi = _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.e.parse(abi || []);
    this.contractWrapper = contractWrapper;
    this.storage = storage;
    this.metadata = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.ag(this.contractWrapper, _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.dT, this.storage);
    this.app = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.a$(this.contractWrapper, this.metadata, this.storage);
    this.encoder = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.af(this.contractWrapper);
    this.estimator = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aP(this.contractWrapper);
    this.events = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aQ(this.contractWrapper);
    this.interceptor = new _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aR(this.contractWrapper);
  }
  onNetworkUpdated(network) {
    this.contractWrapper.updateSignerOrProvider(network);
  }
  getAddress() {
    return this.contractWrapper.readContract.address;
  }

  /** ******************************
   * READ FUNCTIONS
   *******************************/

  /**
   * Get a proposal by id.
   *
   * @param proposalId - The proposal id to get.
   * @returns - The proposal.
   */
  async get(proposalId) {
    const all = await this.getAll();
    const proposals = all.filter(p => p.proposalId.eq(ethers__WEBPACK_IMPORTED_MODULE_10__.BigNumber.from(proposalId)));
    if (proposals.length === 0) {
      throw new Error("proposal not found");
    }
    return proposals[0];
  }

  /**
   * Get All Proposals
   *
   * @remarks Get all the proposals in this contract.
   *
   * @example
   * ```javascript
   * const proposals = await contract.getAll();
   * console.log(proposals);
   * ```
   *
   * @returns - All the proposals in the contract.
   */
  async getAll() {
    return Promise.all((await this.contractWrapper.readContract.getAllProposals()).map(async data => ({
      proposalId: data.proposalId,
      proposer: data.proposer,
      description: data.description,
      startBlock: data.startBlock,
      endBlock: data.endBlock,
      state: await this.contractWrapper.readContract.state(data.proposalId),
      votes: await this.getProposalVotes(data.proposalId),
      executions: data[3].map((c, i) => ({
        toAddress: data.targets[i],
        nativeTokenValue: c,
        transactionData: data.calldatas[i]
      }))
    })));
  }

  /**
   * Get the votes for a specific proposal
   * @param proposalId - the proposalId
   */
  async getProposalVotes(proposalId) {
    const votes = await this.contractWrapper.readContract.proposalVotes(proposalId);
    return [{
      type: _Vote_3b66775c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.V.Against,
      label: "Against",
      count: votes.againstVotes
    }, {
      type: _Vote_3b66775c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.V.For,
      label: "For",
      count: votes.forVotes
    }, {
      type: _Vote_3b66775c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.V.Abstain,
      label: "Abstain",
      count: votes.abstainVotes
    }];
  }

  /**
   * Check If Wallet Voted
   *
   * @remarks Check if a specified wallet has voted a specific proposal
   *
   * @example
   * ```javascript
   * // The proposal ID of the proposal you want to check
   * const proposalId = "0";
   * // The address of the wallet you want to check to see if they voted
   * const address = "{{wallet_address}}";
   *
   * await contract.hasVoted(proposalId, address);
   * ```
   *
   * @param proposalId - The unique identifier of a proposal .
   * @param account - (optional) wallet account address. Defaults to connected signer.
   * @returns - True if the account has already voted on the proposal.
   */
  async hasVoted(proposalId, account) {
    if (!account) {
      account = await this.contractWrapper.getSignerAddress();
    }
    return this.contractWrapper.readContract.hasVoted(proposalId, await (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.cH)(account));
  }

  /**
   * Can Execute
   *
   * @remarks Check if a proposal can be executed (if the proposal has succeeded).
   *
   * @example
   * ```javascript
   * // The proposal ID of the proposal you want to check
   * const proposalId = "0";
   * const canExecute = await contract.canExecute(proposalId);
   * console.log(canExecute);
   * ```
   *
   * @param proposalId - The proposal ID to check.
   * @returns - True if the proposal can be executed, false otherwise.
   */
  async canExecute(proposalId) {
    await this.ensureExists(proposalId);
    const proposal = await this.get(proposalId);
    const tos = proposal.executions.map(p => p.toAddress);
    const values = proposal.executions.map(p => p.nativeTokenValue);
    const datas = proposal.executions.map(p => p.transactionData);
    const descriptionHash = ethers__WEBPACK_IMPORTED_MODULE_9__.id(proposal.description);
    try {
      await this.contractWrapper.callStatic().execute(tos, values, datas, descriptionHash);
      return true;
    } catch (e) {
      return false;
    }
  }

  /**
   * Check the balance of the project wallet in the native token of the chain
   *
   * @returns - The balance of the project in the native token of the chain
   */
  async balance() {
    const balance = await this.contractWrapper.readContract.provider.getBalance(this.contractWrapper.readContract.address);
    return {
      name: "",
      symbol: "",
      decimals: 18,
      value: balance,
      displayValue: ethers__WEBPACK_IMPORTED_MODULE_12__.formatUnits(balance, 18)
    };
  }

  /**
   * Check the balance of the project wallet in a particular
   * ERC20 token contract
   *
   * @returns - The balance of the project in the native token of the chain
   */
  async balanceOfToken(tokenAddress) {
    const erc20 = new ethers__WEBPACK_IMPORTED_MODULE_13__.Contract(await (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.cH)(tokenAddress), _thirdweb_dev_contracts_js_dist_abis_IERC20_json__WEBPACK_IMPORTED_MODULE_14__, this.contractWrapper.getProvider());
    return await (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.b9)(this.contractWrapper.getProvider(), tokenAddress, await erc20.balanceOf(this.contractWrapper.readContract.address));
  }

  /**
   * Find a proposal by its id.
   *
   * @internal
   * @param proposalId - Proposal to check for
   */
  async ensureExists(proposalId) {
    try {
      await this.contractWrapper.readContract.state(proposalId);
    } catch (e) {
      throw Error(`Proposal ${proposalId} not found`);
    }
  }

  /**
   * Get the Vote contract configuration
   */
  async settings() {
    const [votingDelay, votingPeriod, votingTokenAddress, votingQuorumFraction, proposalTokenThreshold] = await Promise.all([this.contractWrapper.readContract.votingDelay(), this.contractWrapper.readContract.votingPeriod(), this.contractWrapper.readContract.token(), this.contractWrapper.readContract["quorumNumerator()"](), this.contractWrapper.readContract.proposalThreshold()]);
    const votingTokenMetadata = await (0,_contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.b8)(this.contractWrapper.getProvider(), votingTokenAddress);
    return {
      votingDelay: votingDelay.toString(),
      votingPeriod: votingPeriod.toString(),
      votingTokenAddress,
      votingTokenMetadata,
      votingQuorumFraction: votingQuorumFraction.toString(),
      proposalTokenThreshold: proposalTokenThreshold.toString()
    };
  }
  /**
   * @internal
   */
  async prepare(method, args, overrides) {
    return _contract_metadata_88f06ef9_browser_esm_js__WEBPACK_IMPORTED_MODULE_7__.aV.fromContractWrapper({
      contractWrapper: this.contractWrapper,
      method,
      args,
      overrides
    });
  }

  /**
   * @internal
   */
  async call(functionName, args, overrides) {
    return this.contractWrapper.call(functionName, args, overrides);
  }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGhpcmR3ZWItZGV2X3Nka19kaXN0X3ZvdGUtZWFiYzQ2Y2NfYnJvd3Nlcl9lc21fanMuYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE2RTtBQUMrVDtBQUNwVTtBQUNuQjtBQUNVO0FBQ2hEO0FBQ0Y7QUFDaUI7QUFDb0M7QUFDVDtBQUNRO0FBQ0c7QUFDRztBQUNQO0FBQ0U7QUFDSjtBQUNTO0FBQ0o7QUFDQztBQUNGO0FBQ0E7QUFDUDtBQUNVO0FBQ0o7QUFDSjtBQUNNO0FBQ0s7QUFDRztBQUNQO0FBQ0E7QUFDQztBQUNSO0FBQ007QUFDSztBQUNHO0FBQ2Y7QUFDVTtBQUNGO0FBQ0s7QUFDUDtBQUNQO0FBQ1U7QUFDRjtBQUNDO0FBQ1Q7QUFDTztBQUNGO0FBQ1U7QUFDVjtBQUNBO0FBQ0o7QUFDRDtBQUNRO0FBQ1A7QUFDcEM7QUFDNkM7QUFDOUM7QUFDc0M7QUFDOUI7QUFDVjtBQUNnRDtBQUN4QztBQUNxQztBQUNwRDtBQUNRO0FBQ0c7QUFDa0M7QUFDUTtBQUNDO0FBQ1E7QUFDbEQ7QUFDWjtBQUMrRDtBQUNDO0FBQ3hDO0FBQ3VCO0FBQ0M7O0FBRTlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksY0FBYztBQUMxQjtBQUNBLGtDQUFrQyxXQUFXO0FBQzdDLDZDQUE2QyxrQkFBa0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0dBQWtHLDBFQUFlO0FBQ2pILElBQUksdUVBQWU7QUFDbkIsSUFBSSx1RUFBZTtBQUNuQixJQUFJLHVFQUFlO0FBQ25CLElBQUksdUVBQWU7QUFDbkIsSUFBSSx1RUFBZTtBQUNuQixJQUFJLHVFQUFlO0FBQ25CLElBQUksdUVBQWU7QUFDbkIsSUFBSSx1RUFBZTtBQUNuQixJQUFJLHVFQUFlO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsNkNBQVEsT0FBTyw4RUFBYyxnQkFBZ0IsOEVBQVE7QUFDM0UsaUJBQWlCLDhFQUFrQjtBQUNuQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sOEJBQThCLFlBQVk7QUFDMUM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDhFQUFxQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsMEVBQVc7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGhpcmR3ZWItbGVhcm4tdGhlbWUvLi9ub2RlX21vZHVsZXMvQHRoaXJkd2ViLWRldi9zZGsvZGlzdC92b3RlLWVhYmM0NmNjLmJyb3dzZXIuZXNtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IF8gYXMgX2RlZmluZVByb3BlcnR5IH0gZnJvbSAnLi9RdWVyeVBhcmFtcy03ZDk0NzNiNS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBkeiBhcyBDb250cmFjdFdyYXBwZXIsIGRzIGFzIGJ1aWxkVHJhbnNhY3Rpb25GdW5jdGlvbiwgZSBhcyBBYmlTY2hlbWEsIGFnIGFzIENvbnRyYWN0TWV0YWRhdGEsIGRUIGFzIFZvdGVDb250cmFjdFNjaGVtYSwgYSQgYXMgQ29udHJhY3RBcHBVUkksIGFmIGFzIENvbnRyYWN0RW5jb2RlciwgYVAgYXMgR2FzQ29zdEVzdGltYXRvciwgYVEgYXMgQ29udHJhY3RFdmVudHMsIGFSIGFzIENvbnRyYWN0SW50ZXJjZXB0b3IsIGNIIGFzIHJlc29sdmVBZGRyZXNzLCBiOSBhcyBmZXRjaEN1cnJlbmN5VmFsdWUsIGI4IGFzIGZldGNoQ3VycmVuY3lNZXRhZGF0YSwgYVYgYXMgVHJhbnNhY3Rpb24gfSBmcm9tICcuL2NvbnRyYWN0LW1ldGFkYXRhLTg4ZjA2ZWY5LmJyb3dzZXIuZXNtLmpzJztcbmltcG9ydCBFUkMyMEFiaSBmcm9tICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzIwLmpzb24nO1xuaW1wb3J0IHsgQmlnTnVtYmVyLCBldGhlcnMsIENvbnRyYWN0IH0gZnJvbSAnZXRoZXJzJztcbmltcG9ydCB7IFYgYXMgVm90ZVR5cGUgfSBmcm9tICcuL1ZvdGUtM2I2Njc3NWMuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0ICdibi5qcyc7XG5pbXBvcnQgJ3pvZCc7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY2hhaW5zJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lCdXJuYWJsZUVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3AuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzIwX1YyLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BTaW5nbGVQaGFzZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2VfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMjBQZXJtaXQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMyMC5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lNdWx0aWNhbGwuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUJ1cm5hYmxlRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNsYWltYWJsZUVSQzcyMS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEZWxheWVkUmV2ZWFsLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BFUkM3MjFfVjMuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzcyMUVudW1lcmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxU3VwcGx5Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUxhenlNaW50Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSU1pbnRhYmxlRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVNpZ25hdHVyZU1pbnRFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzcyMV9WMS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0xhenlNaW50V2l0aFRpZXIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQnVybmFibGVFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNsYWltYWJsZUVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcDExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzExNTVfVjIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcFNpbmdsZVBoYXNlMTE1NS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2UxMTU1X1YxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NUVudW1lcmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVNpZ25hdHVyZU1pbnRFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvRVJDMjc3MUNvbnRleHQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQXBwVVJJLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNvbnRyYWN0TWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRGlyZWN0TGlzdGluZ3MuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRW5nbGlzaEF1Y3Rpb25zLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSU9mZmVycy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQYWNrVlJGRGlyZWN0Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVBlcm1pc3Npb25zLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVBlcm1pc3Npb25zRW51bWVyYWJsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQbGF0Zm9ybUZlZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQcmltYXJ5U2FsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lSb3lhbHR5Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvT3duYWJsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lBY2NvdW50RmFjdG9yeS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lBY2NvdW50Lmpzb24nO1xuaW1wb3J0ICd0aW55LWludmFyaWFudCc7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9Db250cmFjdFB1Ymxpc2hlci5qc29uJztcbmltcG9ydCAnZXZlbnRlbWl0dGVyMyc7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9Gb3J3YXJkZXIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvc3RvcmFnZSc7XG5pbXBvcnQgJ2Nyb3NzLWZldGNoJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lUaGlyZHdlYkNvbnRyYWN0Lmpzb24nO1xuaW1wb3J0ICdldGhlcnMvbGliL3V0aWxzLmpzJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkMyME1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICd1dWlkJztcbmltcG9ydCAnbWVya2xldHJlZWpzJztcbmltcG9ydCAnZmFzdC1kZWVwLWVxdWFsJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkMxNjUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxTWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NU1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURlbGF5ZWRSZXZlYWxEZXByZWNhdGVkLmpzb24nO1xuaW1wb3J0ICdldGhlcnMvbGliL3V0aWxzJztcbmltcG9ydCAnYnM1OCc7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9UV011bHRpY2hhaW5SZWdpc3RyeUxvZ2ljLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvVFdNdWx0aWNoYWluUmVnaXN0cnlSb3V0ZXIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvZ2VuZXJhdGVkLWFiaXMnO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvVFdGYWN0b3J5Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvVFdSZWdpc3RyeS5qc29uJztcblxuLyoqXG4gKiBDcmVhdGUgYSBkZWNlbnRyYWxpemVkIG9yZ2FuaXphdGlvbiBmb3IgdG9rZW4gaG9sZGVycyB0byB2b3RlIG9uIHByb3Bvc2Fscy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGltcG9ydCB7IFRoaXJkd2ViU0RLIH0gZnJvbSBcIkB0aGlyZHdlYi1kZXYvc2RrXCI7XG4gKlxuICogY29uc3Qgc2RrID0gbmV3IFRoaXJkd2ViU0RLKFwie3tjaGFpbk5hbWV9fVwiKTtcbiAqIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgc2RrLmdldENvbnRyYWN0KFwie3tjb250cmFjdF9hZGRyZXNzfX1cIiwgXCJ2b3RlXCIpO1xuICogYGBgXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBWb3RlIHtcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cblxuICBnZXQgY2hhaW5JZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hhaW5JZDtcbiAgfVxuICBjb25zdHJ1Y3RvcihuZXR3b3JrLCBhZGRyZXNzLCBzdG9yYWdlKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBsZXQgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDoge307XG4gICAgbGV0IGFiaSA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ID8gYXJndW1lbnRzWzRdIDogdW5kZWZpbmVkO1xuICAgIGxldCBjaGFpbklkID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7XG4gICAgbGV0IGNvbnRyYWN0V3JhcHBlciA9IGFyZ3VtZW50cy5sZW5ndGggPiA2ICYmIGFyZ3VtZW50c1s2XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzZdIDogbmV3IENvbnRyYWN0V3JhcHBlcihuZXR3b3JrLCBhZGRyZXNzLCBhYmksIG9wdGlvbnMpO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNvbnRyYWN0V3JhcHBlclwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInN0b3JhZ2VcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJhYmlcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJtZXRhZGF0YVwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImFwcFwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVuY29kZXJcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJlc3RpbWF0b3JcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJldmVudHNcIiwgdm9pZCAwKTtcbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJpbnRlcmNlcHRvclwiLCB2b2lkIDApO1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9jaGFpbklkXCIsIHZvaWQgMCk7XG4gICAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqIFdSSVRFIEZVTkNUSU9OU1xuICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBQcm9wb3NhbFxuICAgICAqXG4gICAgICogQHJlbWFya3MgQ3JlYXRlIGEgbmV3IHByb3Bvc2FsIGZvciB0b2tlbiBob2xkZXJzIHRvIHZvdGUgb24uXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGphdmFzY3JpcHRcbiAgICAgKiAvLyBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIHByb3Bvc2FsIHlvdSB3YW50IHRvIHBhc3NcbiAgICAgKiBjb25zdCBkZXNjcmlwdGlvbiA9IFwiVGhpcyBpcyBhIGdyZWF0IHByb3Bvc2FsIC0gdm90ZSBmb3IgaXQhXCJcbiAgICAgKiAvLyBZb3UgY2FuIChvcHRpb25hbGx5KSBwYXNzIGluIGNvbnRyYWN0IGNhbGxzIHRoYXQgd2lsbCBnZXQgZXhlY3V0ZWQgd2hlbiB0aGUgcHJvcG9zYWwgaXMgZXhlY3V0ZWQuXG4gICAgICogY29uc3QgZXhlY3V0aW9ucyA9IFtcbiAgICAgKiAgIHtcbiAgICAgKiAgICAgLy8gVGhlIGNvbnRyYWN0IHlvdSB3YW50IHRvIG1ha2UgYSBjYWxsIHRvXG4gICAgICogICAgIHRvQWRkcmVzczogXCIweC4uLlwiLFxuICAgICAqICAgICAvLyBUaGUgYW1vdW50IG9mIHRoZSBuYXRpdmUgY3VycmVuY3kgdG8gc2VuZCBpbiB0aGlzIHRyYW5zYWN0aW9uXG4gICAgICogICAgIG5hdGl2ZVRva2VuVmFsdWU6IDAsXG4gICAgICogICAgIC8vIFRyYW5zYWN0aW9uIGRhdGEgdGhhdCB3aWxsIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIHByb3Bvc2FsIGlzIGV4ZWN1dGVkXG4gICAgICogICAgIC8vIFRoaXMgaXMgYW4gZXhhbXBsZSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIGEgdG9rZW4gY29udHJhY3QgKHdoaWNoIHlvdSB3b3VsZCBuZWVkIHRvIHNldCB1cCBpbiBjb2RlKVxuICAgICAqICAgICB0cmFuc2FjdGlvbkRhdGE6IHRva2VuQ29udHJhY3QuZW5jb2Rlci5lbmNvZGUoXG4gICAgICogICAgICAgXCJ0cmFuc2ZlclwiLCBbXG4gICAgICogICAgICAgICBmcm9tQWRkcmVzcyxcbiAgICAgKiAgICAgICAgIGFtb3VudCxcbiAgICAgKiAgICAgICBdXG4gICAgICogICAgICksXG4gICAgICogICB9XG4gICAgICogXVxuICAgICAqXG4gICAgICogY29uc3QgcHJvcG9zYWwgPSBhd2FpdCBjb250cmFjdC5wcm9wb3NlKGRlc2NyaXB0aW9uLCBleGVjdXRpb25zKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBkZXNjcmlwdGlvbiAtIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgcHJvcG9zYWwuXG4gICAgICogQHBhcmFtIGV4ZWN1dGlvbnMgLSBBIHNldCBvZiBleGVjdXRhYmxlIHRyYW5zYWN0aW9ucyB0aGF0IHdpbGwgYmUgcnVuIGlmIHRoZSBwcm9wb3NhbCBpcyBwYXNzZWQgYW5kIGV4ZWN1dGVkLlxuICAgICAqIEByZXR1cm5zIC0gVGhlIGlkIG9mIHRoZSBjcmVhdGVkIHByb3Bvc2FsIGFuZCB0aGUgdHJhbnNhY3Rpb24gcmVjZWlwdC5cbiAgICAgKi9cbiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgXCJwcm9wb3NlXCIsIGJ1aWxkVHJhbnNhY3Rpb25GdW5jdGlvbihhc3luYyAoZGVzY3JpcHRpb24sIGV4ZWN1dGlvbnMpID0+IHtcbiAgICAgIGlmICghZXhlY3V0aW9ucykge1xuICAgICAgICBleGVjdXRpb25zID0gW3tcbiAgICAgICAgICB0b0FkZHJlc3M6IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5hZGRyZXNzLFxuICAgICAgICAgIG5hdGl2ZVRva2VuVmFsdWU6IDAsXG4gICAgICAgICAgdHJhbnNhY3Rpb25EYXRhOiBcIjB4XCJcbiAgICAgICAgfV07XG4gICAgICB9XG4gICAgICBjb25zdCB0b3MgPSBleGVjdXRpb25zLm1hcChwID0+IHAudG9BZGRyZXNzKTtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IGV4ZWN1dGlvbnMubWFwKHAgPT4gcC5uYXRpdmVUb2tlblZhbHVlKTtcbiAgICAgIGNvbnN0IGRhdGFzID0gZXhlY3V0aW9ucy5tYXAocCA9PiBwLnRyYW5zYWN0aW9uRGF0YSk7XG4gICAgICByZXR1cm4gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICAgIG1ldGhvZDogXCJwcm9wb3NlXCIsXG4gICAgICAgIGFyZ3M6IFt0b3MsIHZhbHVlcywgZGF0YXMsIGRlc2NyaXB0aW9uXSxcbiAgICAgICAgcGFyc2U6IHJlY2VpcHQgPT4ge1xuICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5jb250cmFjdFdyYXBwZXIucGFyc2VMb2dzKFwiUHJvcG9zYWxDcmVhdGVkXCIsIHJlY2VpcHQ/LmxvZ3MpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogZXZlbnRbMF0uYXJncy5wcm9wb3NhbElkLFxuICAgICAgICAgICAgcmVjZWlwdFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pKTtcbiAgICAvKipcbiAgICAgKiBWb3RlXG4gICAgICpcbiAgICAgKiBAcmVtYXJrcyBWb3RlIG9uIGFuIGFjdGl2ZSBwcm9wb3NhbFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogLy8gVGhlIHByb3Bvc2FsIElEIG9mIHRoZSBwcm9wb3NhbCB5b3Ugd2FudCB0byB2b3RlIG9uXG4gICAgICogY29uc3QgcHJvcG9zYWxJZCA9IFwiMFwiO1xuICAgICAqIC8vIFRoZSB2b3RlIHR5cGUgeW91IHdhbnQgdG8gY2FzdCwgY2FuIGJlIFZvdGVUeXBlLkFnYWluc3QsIFZvdGVUeXBlLkZvciwgb3IgVm90ZVR5cGUuQWJzdGFpblxuICAgICAqIGNvbnN0IHZvdGVUeXBlID0gVm90ZVR5cGUuRm9yO1xuICAgICAqIC8vIFRoZSAob3B0aW9uYWwpIHJlYXNvbiBmb3IgdGhlIHZvdGVcbiAgICAgKiBjb25zdCByZWFzb24gPSBcIkkgbGlrZSB0aGlzIHByb3Bvc2FsIVwiO1xuICAgICAqXG4gICAgICogYXdhaXQgY29udHJhY3Qudm90ZShwcm9wb3NhbElkLCB2b3RlVHlwZSwgcmVhc29uKTtcbiAgICAgKiBgYGBcbiAgICAgKiBAcGFyYW0gcHJvcG9zYWxJZCAtIFRoZSBwcm9wb3NhbCB0byBjYXN0IGEgdm90ZSBvbi5cbiAgICAgKiBAcGFyYW0gdm90ZVR5cGUgLSBUaGUgcG9zaXRpb24gdGhlIHZvdGVyIGlzIHRha2luZyBvbiB0aGVpciB2b3RlLlxuICAgICAqIEBwYXJhbSByZWFzb24gLSAob3B0aW9uYWwpIFRoZSByZWFzb24gZm9yIHRoZSB2b3RlLlxuICAgICAqL1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInZvdGVcIiwgYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIGZ1bmN0aW9uIChwcm9wb3NhbElkLCB2b3RlVHlwZSkge1xuICAgICAgbGV0IHJlYXNvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogXCJcIjtcbiAgICAgIGF3YWl0IF90aGlzLmVuc3VyZUV4aXN0cyhwcm9wb3NhbElkKTtcbiAgICAgIHJldHVybiBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgICAgY29udHJhY3RXcmFwcGVyOiBfdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICAgIG1ldGhvZDogXCJjYXN0Vm90ZVdpdGhSZWFzb25cIixcbiAgICAgICAgYXJnczogW3Byb3Bvc2FsSWQsIHZvdGVUeXBlLCByZWFzb25dXG4gICAgICB9KTtcbiAgICB9KSk7XG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBQcm9wb3NhbFxuICAgICAqXG4gICAgICogQHJlbWFya3MgRXhlY3V0ZSB0aGUgcmVsYXRlZCB0cmFuc2FjdGlvbnMgZm9yIGEgcHJvcG9zYWwgaWYgdGhlIHByb3Bvc2FsIHN1Y2NlZWRlZC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIC8vIFRoZSBwcm9wb3NhbCBJRCBvZiB0aGUgcHJvcG9zYWwgeW91IHdhbnQgdG8gZXhlY3V0ZVxuICAgICAqIGNvbnN0IHByb3Bvc2FsSWQgPSBcIjBcIlxuICAgICAqIGF3YWl0IGNvbnRyYWN0LmV4ZWN1dGUocHJvcG9zYWxJZCk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHJvcG9zYWxJZCAtIFRoZSBwcm9wb3NhbCBpZCB0byBleGVjdXRlLlxuICAgICAqL1xuICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImV4ZWN1dGVcIiwgYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIHByb3Bvc2FsSWQgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5lbnN1cmVFeGlzdHMocHJvcG9zYWxJZCk7XG4gICAgICBjb25zdCBwcm9wb3NhbCA9IGF3YWl0IHRoaXMuZ2V0KHByb3Bvc2FsSWQpO1xuICAgICAgY29uc3QgdG9zID0gcHJvcG9zYWwuZXhlY3V0aW9ucy5tYXAocCA9PiBwLnRvQWRkcmVzcyk7XG4gICAgICBjb25zdCB2YWx1ZXMgPSBwcm9wb3NhbC5leGVjdXRpb25zLm1hcChwID0+IHAubmF0aXZlVG9rZW5WYWx1ZSk7XG4gICAgICBjb25zdCBkYXRhcyA9IHByb3Bvc2FsLmV4ZWN1dGlvbnMubWFwKHAgPT4gcC50cmFuc2FjdGlvbkRhdGEpO1xuICAgICAgY29uc3QgZGVzY3JpcHRpb25IYXNoID0gZXRoZXJzLnV0aWxzLmlkKHByb3Bvc2FsLmRlc2NyaXB0aW9uKTtcbiAgICAgIHJldHVybiBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgICAgbWV0aG9kOiBcImV4ZWN1dGVcIixcbiAgICAgICAgYXJnczogW3RvcywgdmFsdWVzLCBkYXRhcywgZGVzY3JpcHRpb25IYXNoXVxuICAgICAgfSk7XG4gICAgfSkpO1xuICAgIHRoaXMuX2NoYWluSWQgPSBjaGFpbklkO1xuICAgIHRoaXMuYWJpID0gQWJpU2NoZW1hLnBhcnNlKGFiaSB8fCBbXSk7XG4gICAgdGhpcy5jb250cmFjdFdyYXBwZXIgPSBjb250cmFjdFdyYXBwZXI7XG4gICAgdGhpcy5zdG9yYWdlID0gc3RvcmFnZTtcbiAgICB0aGlzLm1ldGFkYXRhID0gbmV3IENvbnRyYWN0TWV0YWRhdGEodGhpcy5jb250cmFjdFdyYXBwZXIsIFZvdGVDb250cmFjdFNjaGVtYSwgdGhpcy5zdG9yYWdlKTtcbiAgICB0aGlzLmFwcCA9IG5ldyBDb250cmFjdEFwcFVSSSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5tZXRhZGF0YSwgdGhpcy5zdG9yYWdlKTtcbiAgICB0aGlzLmVuY29kZXIgPSBuZXcgQ29udHJhY3RFbmNvZGVyKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgICB0aGlzLmVzdGltYXRvciA9IG5ldyBHYXNDb3N0RXN0aW1hdG9yKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgICB0aGlzLmV2ZW50cyA9IG5ldyBDb250cmFjdEV2ZW50cyh0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gICAgdGhpcy5pbnRlcmNlcHRvciA9IG5ldyBDb250cmFjdEludGVyY2VwdG9yKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgfVxuICBvbk5ldHdvcmtVcGRhdGVkKG5ldHdvcmspIHtcbiAgICB0aGlzLmNvbnRyYWN0V3JhcHBlci51cGRhdGVTaWduZXJPclByb3ZpZGVyKG5ldHdvcmspO1xuICB9XG4gIGdldEFkZHJlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5hZGRyZXNzO1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBSRUFEIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogR2V0IGEgcHJvcG9zYWwgYnkgaWQuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wb3NhbElkIC0gVGhlIHByb3Bvc2FsIGlkIHRvIGdldC5cbiAgICogQHJldHVybnMgLSBUaGUgcHJvcG9zYWwuXG4gICAqL1xuICBhc3luYyBnZXQocHJvcG9zYWxJZCkge1xuICAgIGNvbnN0IGFsbCA9IGF3YWl0IHRoaXMuZ2V0QWxsKCk7XG4gICAgY29uc3QgcHJvcG9zYWxzID0gYWxsLmZpbHRlcihwID0+IHAucHJvcG9zYWxJZC5lcShCaWdOdW1iZXIuZnJvbShwcm9wb3NhbElkKSkpO1xuICAgIGlmIChwcm9wb3NhbHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwcm9wb3NhbCBub3QgZm91bmRcIik7XG4gICAgfVxuICAgIHJldHVybiBwcm9wb3NhbHNbMF07XG4gIH1cblxuICAvKipcbiAgICogR2V0IEFsbCBQcm9wb3NhbHNcbiAgICpcbiAgICogQHJlbWFya3MgR2V0IGFsbCB0aGUgcHJvcG9zYWxzIGluIHRoaXMgY29udHJhY3QuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3QgcHJvcG9zYWxzID0gYXdhaXQgY29udHJhY3QuZ2V0QWxsKCk7XG4gICAqIGNvbnNvbGUubG9nKHByb3Bvc2Fscyk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcmV0dXJucyAtIEFsbCB0aGUgcHJvcG9zYWxzIGluIHRoZSBjb250cmFjdC5cbiAgICovXG4gIGFzeW5jIGdldEFsbCgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoKGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5nZXRBbGxQcm9wb3NhbHMoKSkubWFwKGFzeW5jIGRhdGEgPT4gKHtcbiAgICAgIHByb3Bvc2FsSWQ6IGRhdGEucHJvcG9zYWxJZCxcbiAgICAgIHByb3Bvc2VyOiBkYXRhLnByb3Bvc2VyLFxuICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICBzdGFydEJsb2NrOiBkYXRhLnN0YXJ0QmxvY2ssXG4gICAgICBlbmRCbG9jazogZGF0YS5lbmRCbG9jayxcbiAgICAgIHN0YXRlOiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3Quc3RhdGUoZGF0YS5wcm9wb3NhbElkKSxcbiAgICAgIHZvdGVzOiBhd2FpdCB0aGlzLmdldFByb3Bvc2FsVm90ZXMoZGF0YS5wcm9wb3NhbElkKSxcbiAgICAgIGV4ZWN1dGlvbnM6IGRhdGFbM10ubWFwKChjLCBpKSA9PiAoe1xuICAgICAgICB0b0FkZHJlc3M6IGRhdGEudGFyZ2V0c1tpXSxcbiAgICAgICAgbmF0aXZlVG9rZW5WYWx1ZTogYyxcbiAgICAgICAgdHJhbnNhY3Rpb25EYXRhOiBkYXRhLmNhbGxkYXRhc1tpXVxuICAgICAgfSkpXG4gICAgfSkpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHZvdGVzIGZvciBhIHNwZWNpZmljIHByb3Bvc2FsXG4gICAqIEBwYXJhbSBwcm9wb3NhbElkIC0gdGhlIHByb3Bvc2FsSWRcbiAgICovXG4gIGFzeW5jIGdldFByb3Bvc2FsVm90ZXMocHJvcG9zYWxJZCkge1xuICAgIGNvbnN0IHZvdGVzID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LnByb3Bvc2FsVm90ZXMocHJvcG9zYWxJZCk7XG4gICAgcmV0dXJuIFt7XG4gICAgICB0eXBlOiBWb3RlVHlwZS5BZ2FpbnN0LFxuICAgICAgbGFiZWw6IFwiQWdhaW5zdFwiLFxuICAgICAgY291bnQ6IHZvdGVzLmFnYWluc3RWb3Rlc1xuICAgIH0sIHtcbiAgICAgIHR5cGU6IFZvdGVUeXBlLkZvcixcbiAgICAgIGxhYmVsOiBcIkZvclwiLFxuICAgICAgY291bnQ6IHZvdGVzLmZvclZvdGVzXG4gICAgfSwge1xuICAgICAgdHlwZTogVm90ZVR5cGUuQWJzdGFpbixcbiAgICAgIGxhYmVsOiBcIkFic3RhaW5cIixcbiAgICAgIGNvdW50OiB2b3Rlcy5hYnN0YWluVm90ZXNcbiAgICB9XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBJZiBXYWxsZXQgVm90ZWRcbiAgICpcbiAgICogQHJlbWFya3MgQ2hlY2sgaWYgYSBzcGVjaWZpZWQgd2FsbGV0IGhhcyB2b3RlZCBhIHNwZWNpZmljIHByb3Bvc2FsXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIHByb3Bvc2FsIElEIG9mIHRoZSBwcm9wb3NhbCB5b3Ugd2FudCB0byBjaGVja1xuICAgKiBjb25zdCBwcm9wb3NhbElkID0gXCIwXCI7XG4gICAqIC8vIFRoZSBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgeW91IHdhbnQgdG8gY2hlY2sgdG8gc2VlIGlmIHRoZXkgdm90ZWRcbiAgICogY29uc3QgYWRkcmVzcyA9IFwie3t3YWxsZXRfYWRkcmVzc319XCI7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0Lmhhc1ZvdGVkKHByb3Bvc2FsSWQsIGFkZHJlc3MpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIHByb3Bvc2FsSWQgLSBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgYSBwcm9wb3NhbCAuXG4gICAqIEBwYXJhbSBhY2NvdW50IC0gKG9wdGlvbmFsKSB3YWxsZXQgYWNjb3VudCBhZGRyZXNzLiBEZWZhdWx0cyB0byBjb25uZWN0ZWQgc2lnbmVyLlxuICAgKiBAcmV0dXJucyAtIFRydWUgaWYgdGhlIGFjY291bnQgaGFzIGFscmVhZHkgdm90ZWQgb24gdGhlIHByb3Bvc2FsLlxuICAgKi9cbiAgYXN5bmMgaGFzVm90ZWQocHJvcG9zYWxJZCwgYWNjb3VudCkge1xuICAgIGlmICghYWNjb3VudCkge1xuICAgICAgYWNjb3VudCA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5oYXNWb3RlZChwcm9wb3NhbElkLCBhd2FpdCByZXNvbHZlQWRkcmVzcyhhY2NvdW50KSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FuIEV4ZWN1dGVcbiAgICpcbiAgICogQHJlbWFya3MgQ2hlY2sgaWYgYSBwcm9wb3NhbCBjYW4gYmUgZXhlY3V0ZWQgKGlmIHRoZSBwcm9wb3NhbCBoYXMgc3VjY2VlZGVkKS5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgcHJvcG9zYWwgSUQgb2YgdGhlIHByb3Bvc2FsIHlvdSB3YW50IHRvIGNoZWNrXG4gICAqIGNvbnN0IHByb3Bvc2FsSWQgPSBcIjBcIjtcbiAgICogY29uc3QgY2FuRXhlY3V0ZSA9IGF3YWl0IGNvbnRyYWN0LmNhbkV4ZWN1dGUocHJvcG9zYWxJZCk7XG4gICAqIGNvbnNvbGUubG9nKGNhbkV4ZWN1dGUpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIHByb3Bvc2FsSWQgLSBUaGUgcHJvcG9zYWwgSUQgdG8gY2hlY2suXG4gICAqIEByZXR1cm5zIC0gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgY2FuIGJlIGV4ZWN1dGVkLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBhc3luYyBjYW5FeGVjdXRlKHByb3Bvc2FsSWQpIHtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZUV4aXN0cyhwcm9wb3NhbElkKTtcbiAgICBjb25zdCBwcm9wb3NhbCA9IGF3YWl0IHRoaXMuZ2V0KHByb3Bvc2FsSWQpO1xuICAgIGNvbnN0IHRvcyA9IHByb3Bvc2FsLmV4ZWN1dGlvbnMubWFwKHAgPT4gcC50b0FkZHJlc3MpO1xuICAgIGNvbnN0IHZhbHVlcyA9IHByb3Bvc2FsLmV4ZWN1dGlvbnMubWFwKHAgPT4gcC5uYXRpdmVUb2tlblZhbHVlKTtcbiAgICBjb25zdCBkYXRhcyA9IHByb3Bvc2FsLmV4ZWN1dGlvbnMubWFwKHAgPT4gcC50cmFuc2FjdGlvbkRhdGEpO1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uSGFzaCA9IGV0aGVycy51dGlscy5pZChwcm9wb3NhbC5kZXNjcmlwdGlvbik7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmNhbGxTdGF0aWMoKS5leGVjdXRlKHRvcywgdmFsdWVzLCBkYXRhcywgZGVzY3JpcHRpb25IYXNoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgdGhlIGJhbGFuY2Ugb2YgdGhlIHByb2plY3Qgd2FsbGV0IGluIHRoZSBuYXRpdmUgdG9rZW4gb2YgdGhlIGNoYWluXG4gICAqXG4gICAqIEByZXR1cm5zIC0gVGhlIGJhbGFuY2Ugb2YgdGhlIHByb2plY3QgaW4gdGhlIG5hdGl2ZSB0b2tlbiBvZiB0aGUgY2hhaW5cbiAgICovXG4gIGFzeW5jIGJhbGFuY2UoKSB7XG4gICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5wcm92aWRlci5nZXRCYWxhbmNlKHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5hZGRyZXNzKTtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogXCJcIixcbiAgICAgIHN5bWJvbDogXCJcIixcbiAgICAgIGRlY2ltYWxzOiAxOCxcbiAgICAgIHZhbHVlOiBiYWxhbmNlLFxuICAgICAgZGlzcGxheVZhbHVlOiBldGhlcnMudXRpbHMuZm9ybWF0VW5pdHMoYmFsYW5jZSwgMTgpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB0aGUgYmFsYW5jZSBvZiB0aGUgcHJvamVjdCB3YWxsZXQgaW4gYSBwYXJ0aWN1bGFyXG4gICAqIEVSQzIwIHRva2VuIGNvbnRyYWN0XG4gICAqXG4gICAqIEByZXR1cm5zIC0gVGhlIGJhbGFuY2Ugb2YgdGhlIHByb2plY3QgaW4gdGhlIG5hdGl2ZSB0b2tlbiBvZiB0aGUgY2hhaW5cbiAgICovXG4gIGFzeW5jIGJhbGFuY2VPZlRva2VuKHRva2VuQWRkcmVzcykge1xuICAgIGNvbnN0IGVyYzIwID0gbmV3IENvbnRyYWN0KGF3YWl0IHJlc29sdmVBZGRyZXNzKHRva2VuQWRkcmVzcyksIEVSQzIwQWJpLCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpKTtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hDdXJyZW5jeVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIHRva2VuQWRkcmVzcywgYXdhaXQgZXJjMjAuYmFsYW5jZU9mKHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5hZGRyZXNzKSk7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBhIHByb3Bvc2FsIGJ5IGl0cyBpZC5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqIEBwYXJhbSBwcm9wb3NhbElkIC0gUHJvcG9zYWwgdG8gY2hlY2sgZm9yXG4gICAqL1xuICBhc3luYyBlbnN1cmVFeGlzdHMocHJvcG9zYWxJZCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkQ29udHJhY3Quc3RhdGUocHJvcG9zYWxJZCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgRXJyb3IoYFByb3Bvc2FsICR7cHJvcG9zYWxJZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgVm90ZSBjb250cmFjdCBjb25maWd1cmF0aW9uXG4gICAqL1xuICBhc3luYyBzZXR0aW5ncygpIHtcbiAgICBjb25zdCBbdm90aW5nRGVsYXksIHZvdGluZ1BlcmlvZCwgdm90aW5nVG9rZW5BZGRyZXNzLCB2b3RpbmdRdW9ydW1GcmFjdGlvbiwgcHJvcG9zYWxUb2tlblRocmVzaG9sZF0gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LnZvdGluZ0RlbGF5KCksIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC52b3RpbmdQZXJpb2QoKSwgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZENvbnRyYWN0LnRva2VuKCksIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdFtcInF1b3J1bU51bWVyYXRvcigpXCJdKCksIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWRDb250cmFjdC5wcm9wb3NhbFRocmVzaG9sZCgpXSk7XG4gICAgY29uc3Qgdm90aW5nVG9rZW5NZXRhZGF0YSA9IGF3YWl0IGZldGNoQ3VycmVuY3lNZXRhZGF0YSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCB2b3RpbmdUb2tlbkFkZHJlc3MpO1xuICAgIHJldHVybiB7XG4gICAgICB2b3RpbmdEZWxheTogdm90aW5nRGVsYXkudG9TdHJpbmcoKSxcbiAgICAgIHZvdGluZ1BlcmlvZDogdm90aW5nUGVyaW9kLnRvU3RyaW5nKCksXG4gICAgICB2b3RpbmdUb2tlbkFkZHJlc3MsXG4gICAgICB2b3RpbmdUb2tlbk1ldGFkYXRhLFxuICAgICAgdm90aW5nUXVvcnVtRnJhY3Rpb246IHZvdGluZ1F1b3J1bUZyYWN0aW9uLnRvU3RyaW5nKCksXG4gICAgICBwcm9wb3NhbFRva2VuVGhyZXNob2xkOiBwcm9wb3NhbFRva2VuVGhyZXNob2xkLnRvU3RyaW5nKClcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFzeW5jIHByZXBhcmUobWV0aG9kLCBhcmdzLCBvdmVycmlkZXMpIHtcbiAgICByZXR1cm4gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICBjb250cmFjdFdyYXBwZXI6IHRoaXMuY29udHJhY3RXcmFwcGVyLFxuICAgICAgbWV0aG9kLFxuICAgICAgYXJncyxcbiAgICAgIG92ZXJyaWRlc1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXN5bmMgY2FsbChmdW5jdGlvbk5hbWUsIGFyZ3MsIG92ZXJyaWRlcykge1xuICAgIHJldHVybiB0aGlzLmNvbnRyYWN0V3JhcHBlci5jYWxsKGZ1bmN0aW9uTmFtZSwgYXJncywgb3ZlcnJpZGVzKTtcbiAgfVxufVxuXG5leHBvcnQgeyBWb3RlIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=