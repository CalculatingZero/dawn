"use strict";(self.webpackChunkthirdweb_learn_theme=self.webpackChunkthirdweb_learn_theme||[]).push([[8692],{4646:(e,t,i)=>{function r(e){return"string"==typeof e?Number.parseInt(e,"0x"===e.trim().substring(0,2)?16:10):"bigint"==typeof e?Number(e):e}i.d(t,{n:()=>r})},38692:(e,t,i)=>{i.d(t,{PaperWalletConnector:()=>h});var r=i(16074),n=i(42009),s=i(61322),a=i(46362),o=i(64594),l=i(23123),c=i(4646),d=(i(54146),new WeakMap),u=new WeakMap;class h extends s.C{constructor(e){super(),(0,n._)(this,"id",l.w.paper),(0,n._)(this,"name","Paper Wallet"),(0,n._)(this,"ready",!0),(0,n._)(this,"user",null),(0,r._)(this,d,{writable:!0,value:void 0}),(0,n._)(this,"options",void 0),(0,r._)(this,u,{writable:!0,value:void 0}),(0,n._)(this,"onAccountsChanged",(async e=>{0===e.length?await this.onDisconnect():this.emit("change",{account:o.getAddress(e[0])})})),(0,n._)(this,"onChainChanged",(e=>{const t=(0,c.n)(e),i=-1===this.options.chains.findIndex((e=>e.chainId===t));this.emit("change",{chain:{id:t,unsupported:i}})})),(0,n._)(this,"onDisconnect",(async()=>{this.emit("disconnect")})),this.options=e}getPaperSDK(){return(0,r.b)(this,d)||(0,r.a)(this,d,new Promise((async(e,t)=>{try{const{PaperEmbeddedWalletSdk:t}=await Promise.resolve().then(i.bind(i,46362));e(new t({clientId:this.options.clientId,chain:"Ethereum"}))}catch(e){t(e)}}))),(0,r.b)(this,d)}async connect(e){const t=await this.getPaperSDK();if(!t)throw new Error("Paper SDK not initialized");let i=await t.getUser();switch(i.status){case a.J0.LOGGED_OUT:{let i;i=e?.email?await t.auth.loginWithPaperEmailOtp({email:e.email}):await t.auth.loginWithPaperModal(),this.user=i.user;break}case a.J0.LOGGED_IN_WALLET_INITIALIZED:this.user=i}if(!this.user)throw new Error("Error connecting User");return this.setupListeners(),this.getAddress()}async disconnect(){const e=await(0,r.b)(this,d);await(e?.auth.logout()),this.user=null}async getAddress(){return(await this.getSigner()).getAddress()}async isConnected(){try{return!!await this.getAddress()}catch(e){return!1}}async getProvider(){const e=await this.getSigner();if(!e.provider)throw new Error("Provider not found");return e.provider}async getSigner(){if((0,r.b)(this,u))return(0,r.b)(this,u);if(!this.user){const e=await this.getPaperSDK();let t=await e.getUser();t.status===a.J0.LOGGED_IN_WALLET_INITIALIZED&&(this.user=t)}const e=await(this.user?.wallet.getEthersJsSigner({rpcEndpoint:this.options.chain.rpc[0]}));if(!e)throw new Error("Signer not found");return(0,r.a)(this,u,e),e}async isAuthorized(){return!1}async switchChain(e){const t=this.options.chains.find((t=>t.chainId===e));if(!t)throw new Error("Chain not configured");await(this.user?.wallet.setChain({chain:"Ethereum"})),(0,r.a)(this,u,await(this.user?.wallet.getEthersJsSigner({rpcEndpoint:t.rpc[0]}))),this.emit("change",{chain:{id:e,unsupported:!1}})}async setupListeners(){const e=await this.getProvider();e.on&&(e.on("accountsChanged",this.onAccountsChanged),e.on("chainChanged",this.onChainChanged),e.on("disconnect",this.onDisconnect))}updateChains(e){this.options.chains=e}async getEmail(){if(await this.getProvider(),!this.user)throw new Error("No user found, Paper Wallet is not connected");return this.user.authDetails.email}}},46362:(e,t,i)=>{i.d(t,{PaperEmbeddedWalletSdk:()=>q,J0:()=>C});var r,n,s,a={Ethereum:"https://rpc.ankr.com/eth",Goerli:"https://goerli.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",Mumbai:"https://rpc-mumbai.maticvigil.com",Polygon:"https://rpc-mainnet.maticvigil.com",Avalanche:"https://api.avax.network/ext/bc/C/rpc",Optimism:"https://optimism.rpc.thirdweb.com",OptimismGoerli:"https://optimism-goerli.rpc.thirdweb.com",BSC:"https://binance.rpc.thirdweb.com",BSCTestnet:"https://binance-testnet.rpc.thirdweb.com",ArbitrumOne:"https://arbitrum.rpc.thirdweb.com",ArbitrumGoerli:"https://arbitrum-goerli.rpc.thirdweb.com",Fantom:"https://fantom.rpc.thirdweb.com",FantomTestnet:"https://fantom-testnet.rpc.thirdweb.com"},o=()=>{var e;return"undefined"!=typeof window&&"true"===window.localStorage.getItem("IS_PAPER_DEV")?null!=(e=window.localStorage.getItem("PAPER_DEV_URL"))?e:"http://localhost:3000":"undefined"!=typeof window&&window.location.origin.includes("paper.xyz")?window.location.origin:"https://withpaper.com"},l=i(60101),c=i(48171),d=i(53587),u=Object.defineProperty,h=Object.defineProperties,p=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,w=(e,t,i)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,y=(e,t)=>{for(var i in t||(t={}))m.call(t,i)&&w(e,i,t[i]);if(g)for(var i of g(t))I.call(t,i)&&w(e,i,t[i]);return e},v=(e,t)=>h(e,p(t)),f=(e,t,i)=>new Promise(((r,n)=>{var s=e=>{try{o(i.next(e))}catch(e){n(e)}},a=e=>{try{o(i.throw(e))}catch(e){n(e)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,a);o((i=i.apply(e,t)).next())})),E="/sdk/2022-08-12/embedded-wallet",L=e=>`paperEwsWalletUserId-${e}`,S=e=>`walletToken-${e}`,A=(e,t)=>`a-${e}-${t}`,_=((s=_||{}).PAPER_EMAIL_OTP="PaperEmailOTP",s.GOOGLE="Google",s.TWITTER="Twitter",s.AUTH0="Auth0",s.CUSTOM_JWT="CustomJWT",s),C=((n=C||{}).LOGGED_OUT="Logged Out",n.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",n),b=((r=b||{}).LOGGED_OUT="Logged Out",r.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",r.LOGGED_IN_NEW_DEVICE="Logged In, New Device",r.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",r),D=new Map,P=class{constructor({clientId:e}){this.isSupported="undefined"!=typeof window&&!!window.localStorage,this.clientId=e}getItem(e){return f(this,null,(function*(){var t;return this.isSupported?window.localStorage.getItem(e):null!=(t=D.get(e))?t:null}))}setItem(e,t){return f(this,null,(function*(){if(this.isSupported)return window.localStorage.setItem(e,t);D.set(e,t)}))}removeItem(e){return f(this,null,(function*(){let t=yield this.getItem(e);return!(!this.isSupported||!t||(window.localStorage.removeItem(e),0))}))}saveAuthCookie(e){return f(this,null,(function*(){yield this.setItem(S(this.clientId),e)}))}getAuthCookie(){return f(this,null,(function*(){return this.getItem(S(this.clientId))}))}removeAuthCookie(){return f(this,null,(function*(){return this.removeItem(S(this.clientId))}))}saveDeviceShare(e,t){return f(this,null,(function*(){yield this.saveWalletUserId(t),yield this.setItem(A(this.clientId,t),e)}))}getDeviceShare(){return f(this,null,(function*(){let e=yield this.getWalletUserId();return e?this.getItem(A(this.clientId,e)):null}))}removeDeviceShare(){return f(this,null,(function*(){let e=yield this.getWalletUserId();return!!e&&this.removeItem(A(this.clientId,e))}))}getWalletUserId(){return f(this,null,(function*(){return this.getItem(L(this.clientId))}))}saveWalletUserId(e){return f(this,null,(function*(){yield this.setItem(L(this.clientId),e)}))}removeWalletUserId(){return f(this,null,(function*(){return this.removeItem(L(this.clientId))}))}};function O(e){return new Promise((t=>{setTimeout(t,1e3*e)}))}var T={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},W=new Map,N=class{constructor({link:e,iframeId:t,container:i=document.body,iframeStyles:r,onIframeInitialize:n}){this.POLLING_INTERVAL_SECONDS=1.4,this.POST_LOAD_BUFFER_SECONDS=1;let s=document.getElementById(t),a=new URL(e),o="1.0.1";if(a.searchParams.set("sdkVersion",o),!s||s.src!=a.href){if(!s){s=document.createElement("iframe");let e=y(y({},T),r);Object.assign(s.style,e),s.setAttribute("id",t),i.appendChild(s)}s.src=a.href,s.setAttribute("data-version",o),s.onload=this.onIframeLoadHandler(s,this.POST_LOAD_BUFFER_SECONDS,n)}this.iframe=s}onIframeLoadedInitVariables(){return f(this,null,(function*(){return{}}))}onIframeLoadHandler(e,t,i){return()=>f(this,null,(function*(){yield new Promise(((r,n)=>f(this,null,(function*(){var s;let a=new MessageChannel;a.port1.onmessage=t=>{let{data:s}=t;return a.port1.close(),s.success?(W.set(e.src,!0),i&&i(),r(!0)):n(new Error(s.error))},yield O(t),null==(s=null==e?void 0:e.contentWindow)||s.postMessage({eventType:"initIframe",data:yield this.onIframeLoadedInitVariables()},`${o()}${E}`,[a.port2])}))))}))}call(e){return f(this,arguments,(function*({procedureName:e,params:t,showIframe:i=!1,injectRecoveryCode:r={isInjectRecoveryCode:!1}}){for(;!W.get(this.iframe.src);)yield O(this.POLLING_INTERVAL_SECONDS);return i&&(this.iframe.style.display="block",yield O(.005)),new Promise(((n,s)=>{var a;if(r.isInjectRecoveryCode){let e=t=>f(this,null,(function*(){var i,n;if(t.origin!==o()||"paper_getRecoveryCode"!==t.data.type||"string"!=typeof t.data.userWalletId)return;let s=yield null==(i=r.getRecoveryCode)?void 0:i.call(r,t.data.userWalletId);null==(n=this.iframe.contentWindow)||n.postMessage({type:"paper_getRecoveryCode_response",recoveryCode:s},o()),window.removeEventListener("message",e)}));window.addEventListener("message",e)}let l=new MessageChannel;l.port1.onmessage=e=>f(this,null,(function*(){let{data:t}=e;l.port1.close(),i&&(yield O(.1),this.iframe.style.display="none"),t.success?n(t.data):s(new Error(t.error))})),null==(a=this.iframe.contentWindow)||a.postMessage({eventType:e,data:t},`${o()}${E}`,[l.port2])}))}))}destroy(){W.delete(this.iframe.src)}},U=class extends N{constructor({clientId:e,customizationOptions:t}){super({iframeId:R,link:k({clientId:e,path:E,queryParams:t}).href,container:document.body}),this.clientId=e}onIframeLoadedInitVariables(){return f(this,null,(function*(){let e=new P({clientId:this.clientId});return{authCookie:yield e.getAuthCookie(),deviceShareStored:yield e.getDeviceShare(),walletUserId:yield e.getWalletUserId(),clientId:this.clientId}}))}};function k({clientId:e,path:t,queryParams:i}){var r;let n=new URL(t,o());if(i)for(let e of Object.keys(i))n.searchParams.set(e,(null==(r=i[e])?void 0:r.toString())||"");return n.searchParams.set("clientId",e),n}var R="paper-embedded-wallet-iframe",M=class{constructor({chain:e,clientId:t,querier:i}){this.chain=e,this.clientId=t,this.gaslessTransactionQuerier=i}callContract(e){return f(this,arguments,(function*({contractAddress:e,methodArgs:t,methodInterface:i}){return yield this.gaslessTransactionQuerier.call({procedureName:"callContract",params:{chain:this.chain,contractAddress:e,method:{args:t,stub:i}}})}))}},G=class extends c.Signer{constructor({provider:e,clientId:t,querier:i}){var r;super(),this.DEFAULT_ETHEREUM_CHAIN_ID=5,this.clientId=t,this.querier=i,this.endpoint=null==(r=e.connection)?void 0:r.url,(0,d.defineReadOnly)(this,"provider",e)}getAddress(){return f(this,null,(function*(){let{address:e}=yield this.querier.call({procedureName:"getAddress",params:void 0});return e}))}signMessage(e){return f(this,null,(function*(){var t,i,r,n;let s=yield null==(t=this.provider)?void 0:t.getNetwork();s&&s._defaultProvider;let{signedMessage:a}=yield this.querier.call({procedureName:"signMessage",params:{message:e,chainId:null!=(n=null==(r=yield null==(i=this.provider)?void 0:i.getNetwork())?void 0:r.chainId)?n:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return a}))}signTransaction(e){return f(this,null,(function*(){var t,i,r;let{signedTransaction:n}=yield this.querier.call({procedureName:"signTransaction",params:{transaction:e,chainId:null!=(r=null==(i=yield null==(t=this.provider)?void 0:t.getNetwork())?void 0:i.chainId)?r:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return n}))}_signTypedData(e,t,i){return f(this,null,(function*(){var r,n,s;let{signedTypedData:a}=yield this.querier.call({procedureName:"signTypedDataV4",params:{domain:e,types:t,message:i,chainId:null!=(s=null==(n=yield null==(r=this.provider)?void 0:r.getNetwork())?void 0:n.chainId)?s:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return a}))}connect(e){return new G({clientId:this.clientId,provider:e,querier:this.querier})}},q=class{constructor({clientId:e,chain:t,styles:i}){this.clientId=e,this.querier=new U({clientId:e,customizationOptions:i}),this.wallet=new class{constructor({clientId:e,chain:t,querier:i}){this.clientId=e,this.chain=t,this.walletManagerQuerier=i,this.gasless=new M({chain:t,clientId:e,querier:i}),this.localStorage=new P({clientId:e})}postWalletSetUp(e){return f(this,arguments,(function*({deviceShareStored:e,walletAddress:t,isIframeStorageEnabled:i,walletUserId:r}){return i||(yield this.localStorage.saveDeviceShare(e,r)),{walletAddress:t}}))}getUserWalletStatus(){return f(this,null,(function*(){let e=yield this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return"Logged In, Wallet Initialized"===e.status?{status:"Logged In, Wallet Initialized",user:v(y({},e.user),{wallet:this})}:e}))}setChain(e){return f(this,arguments,(function*({chain:e}){this.chain=e,this.gasless=new M({chain:e,clientId:this.clientId,querier:this.walletManagerQuerier})}))}getEthersJsSigner(e){return f(this,null,(function*(){var t;return new G({clientId:this.clientId,provider:(0,l.getDefaultProvider)(null!=(t=null==e?void 0:e.rpcEndpoint)?t:a[this.chain]),querier:this.walletManagerQuerier})}))}}({clientId:e,chain:t,querier:this.querier}),this.auth=new class{constructor({clientId:e,querier:t,onAuthSuccess:i}){this.clientId=e,this.AuthQuerier=t,this.localStorage=new P({clientId:e}),this.onAuthSuccess=i}preLogin(){return f(this,null,(function*(){yield this.logout()}))}postLogin(e){return f(this,arguments,(function*({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&(yield this.localStorage.saveAuthCookie(e.cookieString)),yield this.onAuthSuccess({storedToken:e,walletDetails:t})}))}loginWithJwtAuth(e){return f(this,arguments,(function*({token:e,authProvider:t,recoveryCode:i}){yield this.preLogin();let r=yield this.AuthQuerier.call({procedureName:"loginWithJwtAuthCallback",params:{token:e,authProvider:t,recoveryCode:i}});return this.postLogin(r)}))}loginWithPaperModal(e){return f(this,null,(function*(){yield this.preLogin();let t=yield this.AuthQuerier.call({procedureName:"loginWithPaperModal",params:void 0,showIframe:!0,injectRecoveryCode:{isInjectRecoveryCode:!0,getRecoveryCode:null==e?void 0:e.getRecoveryCode}});return this.postLogin(t)}))}loginWithPaperEmailOtp(e){return f(this,arguments,(function*({email:e,recoveryCode:t}){yield this.preLogin();let i=yield this.AuthQuerier.call({procedureName:"loginWithPaperModal",params:{email:e,recoveryCode:t},showIframe:!0,injectRecoveryCode:{isInjectRecoveryCode:!0}});return this.postLogin(i)}))}sendPaperEmailLoginOtp(e){return f(this,arguments,(function*({email:e}){yield this.preLogin();let{isNewUser:t,isNewDevice:i}=yield this.AuthQuerier.call({procedureName:"sendPaperEmailLoginOtp",params:{email:e}});return{isNewUser:t,isNewDevice:i}}))}verifyPaperEmailLoginOtp(e){return f(this,arguments,(function*({email:e,otp:t,recoveryCode:i}){let r=yield this.AuthQuerier.call({procedureName:"verifyPaperEmailLoginOtp",params:{email:e,otp:t,recoveryCode:i},injectRecoveryCode:{isInjectRecoveryCode:!0}});return this.postLogin(r)}))}logout(){return f(this,null,(function*(){let{success:e}=yield this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=yield this.localStorage.removeAuthCookie(),i=yield this.localStorage.removeWalletUserId();return{success:e||t||i}}))}}({clientId:e,querier:this.querier,onAuthSuccess:e=>f(this,null,(function*(){return yield this.wallet.postWalletSetUp(v(y({},e.walletDetails),{walletUserId:e.storedToken.authDetails.userWalletId})),{user:{status:"Logged In, Wallet Initialized",authDetails:e.storedToken.authDetails,wallet:this.wallet,walletAddress:e.walletDetails.walletAddress}}}))})}getUser(){return f(this,null,(function*(){let e=yield this.wallet.getUserWalletStatus();switch(e.status){case"Logged In, New Device":case"Logged In, Wallet Uninitialized":return yield this.auth.logout(),this.getUser();case"Logged Out":return{status:"Logged Out"};case"Logged In, Wallet Initialized":return y({status:"Logged In, Wallet Initialized"},e.user)}}))}}}}]);